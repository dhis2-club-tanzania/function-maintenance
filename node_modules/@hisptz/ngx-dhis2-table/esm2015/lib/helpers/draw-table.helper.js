/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * @param {?} analyticsObject
 * @param {?} tableConfiguration
 * @return {?}
 */
export function drawTable(analyticsObject, tableConfiguration) {
    const /** @type {?} */ legendClasses = tableConfiguration.legendSet
        ? tableConfiguration.legendSet.legends
        : null;
    const /** @type {?} */ table = {
        headers: [],
        columns: [],
        rows: [],
        titles: {
            rows: [],
            column: []
        },
        titlesAvailable: false,
        hasParentOu: false
    };
    if (tableConfiguration.hasOwnProperty('title')) {
        table['title'] = tableConfiguration.title;
    }
    if (tableConfiguration.hasOwnProperty('subtitle')) {
        table['subtitle'] = tableConfiguration.subtitle;
    }
    if (tableConfiguration.displayList) {
        table.headers[0] = {
            items: [],
            style: ''
        };
        tableConfiguration.columns[tableConfiguration.columns.indexOf('pe')] =
            'eventdate';
        tableConfiguration.columns[tableConfiguration.columns.indexOf('ou')] =
            'ouname';
        for (const /** @type {?} */ item of tableConfiguration.columns) {
            table.headers[0].items.push({
                name: analyticsObject.headers[getTitleIndex(analyticsObject.headers, item)]
                    .column,
                span: 1
            });
        }
        for (const /** @type {?} */ item of analyticsObject.rows) {
            const /** @type {?} */ column_items = [];
            for (const /** @type {?} */ col of tableConfiguration.columns) {
                const /** @type {?} */ index = getTitleIndex(analyticsObject.headers, col);
                column_items.push({
                    name: '',
                    display: true,
                    row_span: '1',
                    // color:getColor(item[index],)
                    val: item[index]
                });
            }
            table.rows.push({
                headers: [],
                items: column_items
            });
        }
    }
    else {
        // add names to titles array
        if (tableConfiguration.showDimensionLabels) {
            table.titlesAvailable = true;
            for (const /** @type {?} */ item of tableConfiguration.columns) {
                table.titles.column.push(analyticsObject.headers[getTitleIndex(analyticsObject.headers, item)]
                    .column);
            }
            for (const /** @type {?} */ item of tableConfiguration.rows) {
                table.titles.rows.push(analyticsObject.headers[getTitleIndex(analyticsObject.headers, item)]
                    .column);
            }
        }
        for (const /** @type {?} */ columnItem of tableConfiguration.columns) {
            const /** @type {?} */ dimension = calculateColSpan(analyticsObject, tableConfiguration.columns, columnItem);
            const /** @type {?} */ currentColumnItems = prepareSingleCategories(analyticsObject, columnItem);
            const /** @type {?} */ headerItem = [];
            for (let /** @type {?} */ i = 0; i < dimension.duplication; i++) {
                for (const /** @type {?} */ currentItem of currentColumnItems) {
                    headerItem.push({
                        name: currentItem.name,
                        span: dimension.col_span,
                        type: currentItem.type,
                        id: currentItem.uid
                    });
                }
            }
            let /** @type {?} */ styles = '';
            if (tableConfiguration.hasOwnProperty('style')) {
                if (tableConfiguration.styles.hasOwnProperty(columnItem)) {
                    styles = tableConfiguration.styles[columnItem];
                }
            }
            table.headers.push({ items: headerItem, style: styles });
        }
        for (const /** @type {?} */ rowItem of tableConfiguration.rows) {
            table.columns.push(rowItem);
        }
        // Preparing table columns
        const /** @type {?} */ column_length = tableConfiguration.columns.length;
        const /** @type {?} */ column_items_array = [];
        for (let /** @type {?} */ i = 0; i < column_length; i++) {
            const /** @type {?} */ currentRowItems = prepareSingleCategories(analyticsObject, tableConfiguration.columns[i]);
            column_items_array.push(currentRowItems);
        }
        let /** @type {?} */ table_columns_array = [];
        for (let /** @type {?} */ i = 0; i < column_items_array.length; i++) {
            if (table_columns_array.length === 0) {
                for (const /** @type {?} */ item of column_items_array[i]) {
                    table_columns_array.push([item]);
                }
            }
            else {
                const /** @type {?} */ temp_arr = table_columns_array.concat();
                table_columns_array = [];
                for (const /** @type {?} */ item of temp_arr) {
                    for (const /** @type {?} */ val of column_items_array[i]) {
                        if (item instanceof Array) {
                            const /** @type {?} */ tempArr = Array.from(item);
                            table_columns_array.push(tempArr.concat([val]));
                        }
                        else {
                            table_columns_array.push([item, val]);
                        }
                    }
                }
            }
        }
        // Preparing table rows
        const /** @type {?} */ rows_length = tableConfiguration.rows.length;
        const /** @type {?} */ row_items_array = [];
        for (let /** @type {?} */ i = 0; i < rows_length; i++) {
            const /** @type {?} */ dimension = calculateColSpan(analyticsObject, tableConfiguration.rows, tableConfiguration.rows[i]);
            const /** @type {?} */ currentRowItems = prepareSingleCategories(analyticsObject, tableConfiguration.rows[i]);
            row_items_array.push({ items: currentRowItems, dimensions: dimension });
        }
        let /** @type {?} */ table_rows_array = [];
        for (let /** @type {?} */ i = 0; i < row_items_array.length; i++) {
            if (table_rows_array.length === 0) {
                for (const /** @type {?} */ item of row_items_array[i].items) {
                    item.dimensions = row_items_array[i].dimensions;
                    table_rows_array.push([item]);
                }
            }
            else {
                const /** @type {?} */ temp_arr = table_rows_array.concat();
                table_rows_array = [];
                for (const /** @type {?} */ item of temp_arr) {
                    for (const /** @type {?} */ val of row_items_array[i].items) {
                        val.dimensions = row_items_array[i].dimensions;
                        if (item instanceof Array) {
                            const /** @type {?} */ tempArr = Array.from(item);
                            table_rows_array.push(tempArr.concat([val]));
                        }
                        else {
                            table_rows_array.push([item, val]);
                        }
                    }
                }
            }
        }
        let /** @type {?} */ counter = 0;
        if (table_rows_array.length !== 0) {
            for (const /** @type {?} */ rowItem of table_rows_array) {
                const /** @type {?} */ item = {
                    items: [],
                    headers: rowItem
                };
                for (const /** @type {?} */ val of rowItem) {
                    if (counter === 0 || counter % val.dimensions.col_span === 0) {
                        item.items.push({
                            type: val.type,
                            name: val.uid,
                            val: val.name,
                            row_span: val.dimensions.col_span,
                            header: true
                        });
                    }
                }
                for (const /** @type {?} */ colItem of table_columns_array) {
                    const /** @type {?} */ dataItem = [];
                    for (const /** @type {?} */ val of rowItem) {
                        dataItem.push({ type: val.type, value: val.uid });
                    }
                    for (const /** @type {?} */ val of colItem) {
                        dataItem.push({ type: val.type, value: val.uid });
                    }
                    item.items.push({
                        name: '',
                        val: getDataValue(analyticsObject, dataItem),
                        color: getDataValueColor(legendClasses, getDataValue(analyticsObject, dataItem)),
                        row_span: '1',
                        display: true
                    });
                }
                if (tableConfiguration.hasOwnProperty('hideEmptyRows') &&
                    tableConfiguration.hideEmptyRows) {
                    if (!checkZeros(tableConfiguration.rows.length, item.items)) {
                        table.rows.push(item);
                    }
                }
                else {
                    table.rows.push(item);
                }
                counter++;
            }
        }
        else {
            const /** @type {?} */ item = {
                items: [],
                headers: []
            };
            for (const /** @type {?} */ colItem of table_columns_array) {
                const /** @type {?} */ dataItem = [];
                for (const /** @type {?} */ val of colItem) {
                    dataItem.push({ type: val.type, value: val.uid });
                }
                item.items.push({
                    name: '',
                    val: getDataValue(analyticsObject, dataItem),
                    row_span: '1',
                    display: true
                });
            }
            if (tableConfiguration.hasOwnProperty('hideEmptyRows') &&
                tableConfiguration.hideEmptyRows) {
                if (!checkZeros(tableConfiguration.rows.length, item.items)) {
                    table.rows.push(item);
                }
            }
            else {
                table.rows.push(item);
            }
        }
    }
    // todo improve total options to also work for event table
    // return _getSanitizedTableObject(table, tableConfiguration);
    return table;
}
/**
 * @param {?} analyticsObjectHeaders
 * @param {?} name
 * @return {?}
 */
function getTitleIndex(analyticsObjectHeaders, name) {
    let /** @type {?} */ index = 0;
    let /** @type {?} */ counter = 0;
    for (const /** @type {?} */ header of analyticsObjectHeaders) {
        if (header.name === name) {
            index = counter;
        }
        counter++;
    }
    return index;
}
/**
 * @param {?} analyticsObject
 * @param {?} array
 * @param {?} item
 * @return {?}
 */
function calculateColSpan(analyticsObject, array, item) {
    const /** @type {?} */ indexOfItem = array.indexOf(item);
    const /** @type {?} */ array_length = array.length;
    const /** @type {?} */ last_index = array_length - 1;
    const /** @type {?} */ dimensions = { col_span: 1, duplication: 1 };
    for (let /** @type {?} */ i = last_index; i > indexOfItem; i--) {
        const /** @type {?} */ arr = prepareSingleCategories(analyticsObject, array[i]);
        dimensions.col_span = dimensions.col_span * arr.length;
    }
    for (let /** @type {?} */ i = 0; i < indexOfItem; i++) {
        const /** @type {?} */ arr = prepareSingleCategories(analyticsObject, array[i]);
        dimensions.duplication = dimensions.duplication * arr.length;
    }
    return dimensions;
}
/**
 * @param {?} initialAnalytics
 * @param {?} itemIdentifier
 * @param {?=} preDefinedItems
 * @return {?}
 */
function prepareSingleCategories(initialAnalytics, itemIdentifier, preDefinedItems = []) {
    const /** @type {?} */ analyticsObject = sanitizeIncomingAnalytics(initialAnalytics);
    const /** @type {?} */ structure = [];
    if (preDefinedItems.length === 0) {
        for (const /** @type {?} */ val of getMetadataArray(analyticsObject, itemIdentifier)) {
            structure.push({
                name: analyticsObject.metaData.names[val],
                uid: val,
                type: itemIdentifier
            });
        }
    }
    if (preDefinedItems.length !== 0) {
        for (const /** @type {?} */ val of preDefinedItems) {
            structure.push({
                name: analyticsObject.metaData.names[val],
                uid: val,
                type: itemIdentifier
            });
        }
    }
    return structure;
}
/**
 * @param {?} analyticsObject
 * @return {?}
 */
function sanitizeIncomingAnalytics(analyticsObject) {
    return analyticsObject;
}
/**
 * @param {?} analyticsObject
 * @param {?} metadataType
 * @return {?}
 */
function getMetadataArray(analyticsObject, metadataType) {
    let /** @type {?} */ metadataArray = [];
    if (metadataType === 'dx') {
        metadataArray = analyticsObject.metaData.dx;
    }
    else if (metadataType === 'ou') {
        metadataArray = analyticsObject.metaData.ou;
    }
    else if (metadataType === 'co') {
        metadataArray = analyticsObject.metaData.co;
    }
    else if (metadataType === 'pe') {
        metadataArray = analyticsObject.metaData.pe;
    }
    else {
        metadataArray = analyticsObject.metaData[metadataType];
    }
    return metadataArray;
}
/**
 * @param {?} analyticsObject
 * @param {?=} dataItems
 * @return {?}
 */
function getDataValue(analyticsObject, dataItems = []) {
    let /** @type {?} */ num = null;
    for (const /** @type {?} */ value of analyticsObject.rows) {
        let /** @type {?} */ counter = 0;
        for (const /** @type {?} */ item of dataItems) {
            if (value[getTitleIndex(analyticsObject.headers, item.type)] === item.value) {
                counter++;
            }
        }
        if (counter === dataItems.length) {
            if (isNaN(value[getTitleIndex(analyticsObject.headers, 'value')])) {
                num = value[getTitleIndex(analyticsObject.headers, 'value')];
            }
            else {
                num += parseFloat(value[getTitleIndex(analyticsObject.headers, 'value')]);
            }
        }
    }
    return num;
}
/**
 * @param {?} legendClasses
 * @param {?} value
 * @return {?}
 */
function getDataValueColor(legendClasses, value) {
    let /** @type {?} */ color = '';
    if (!isNaN(value) && legendClasses) {
        legendClasses.forEach(legendClass => {
            if (legendClass.startValue <= value && legendClass.endValue > value) {
                color = legendClass.color;
            }
            // if (legendClass.startValue < value && legendClass.endValue >= value) {
            // }
        });
    }
    return color;
}
/**
 * @param {?} stating_length
 * @param {?} array
 * @return {?}
 */
function checkZeros(stating_length, array) {
    let /** @type {?} */ checker = true;
    for (let /** @type {?} */ i = stating_length; i < array.length; i++) {
        if (array[i].name === '' && array[i].val != null) {
            checker = false;
        }
    }
    return checker;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhdy10YWJsZS5oZWxwZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaGlzcHR6L25neC1kaGlzMi10YWJsZS8iLCJzb3VyY2VzIjpbImxpYi9oZWxwZXJzL2RyYXctdGFibGUuaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNBLE1BQU0sb0JBQ0osZUFBZSxFQUNmLGtCQUFzQztJQUV0Qyx1QkFBTSxhQUFhLEdBQUcsa0JBQWtCLENBQUMsU0FBUztRQUNoRCxDQUFDLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLE9BQU87UUFDdEMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUVULHVCQUFNLEtBQUssR0FBRztRQUNaLE9BQU8sRUFBRSxFQUFFO1FBQ1gsT0FBTyxFQUFFLEVBQUU7UUFDWCxJQUFJLEVBQUUsRUFBRTtRQUNSLE1BQU0sRUFBRTtZQUNOLElBQUksRUFBRSxFQUFFO1lBQ1IsTUFBTSxFQUFFLEVBQUU7U0FDWDtRQUNELGVBQWUsRUFBRSxLQUFLO1FBQ3RCLFdBQVcsRUFBRSxLQUFLO0tBQ25CLENBQUM7SUFDRixFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9DLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7S0FDM0M7SUFDRCxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xELEtBQUssQ0FBQyxVQUFVLENBQUMsR0FBRyxrQkFBa0IsQ0FBQyxRQUFRLENBQUM7S0FDakQ7SUFDRCxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUc7WUFDakIsS0FBSyxFQUFFLEVBQUU7WUFDVCxLQUFLLEVBQUUsRUFBRTtTQUNWLENBQUM7UUFDRixrQkFBa0IsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsRSxXQUFXLENBQUM7UUFDZCxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsRSxRQUFRLENBQUM7UUFDWCxHQUFHLENBQUMsQ0FBQyx1QkFBTSxJQUFJLElBQUksa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUM5QyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7Z0JBQzFCLElBQUksRUFDRixlQUFlLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO3FCQUNsRSxNQUFNO2dCQUNYLElBQUksRUFBRSxDQUFDO2FBQ1IsQ0FBQyxDQUFDO1NBQ0o7UUFDRCxHQUFHLENBQUMsQ0FBQyx1QkFBTSxJQUFJLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDeEMsdUJBQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQztZQUN4QixHQUFHLENBQUMsQ0FBQyx1QkFBTSxHQUFHLElBQUksa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDN0MsdUJBQU0sS0FBSyxHQUFHLGFBQWEsQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUMxRCxZQUFZLENBQUMsSUFBSSxDQUFDO29CQUNoQixJQUFJLEVBQUUsRUFBRTtvQkFDUixPQUFPLEVBQUUsSUFBSTtvQkFDYixRQUFRLEVBQUUsR0FBRzs7b0JBRWIsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUM7aUJBQ2pCLENBQUMsQ0FBQzthQUNKO1lBQ0QsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ2QsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsS0FBSyxFQUFFLFlBQVk7YUFDcEIsQ0FBQyxDQUFDO1NBQ0o7S0FDRjtJQUFDLElBQUksQ0FBQyxDQUFDOztRQUVOLEVBQUUsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztZQUMzQyxLQUFLLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztZQUM3QixHQUFHLENBQUMsQ0FBQyx1QkFBTSxJQUFJLElBQUksa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDOUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUN0QixlQUFlLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO3FCQUNsRSxNQUFNLENBQ1YsQ0FBQzthQUNIO1lBQ0QsR0FBRyxDQUFDLENBQUMsdUJBQU0sSUFBSSxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FDcEIsZUFBZSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztxQkFDbEUsTUFBTSxDQUNWLENBQUM7YUFDSDtTQUNGO1FBQ0QsR0FBRyxDQUFDLENBQUMsdUJBQU0sVUFBVSxJQUFJLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDcEQsdUJBQU0sU0FBUyxHQUFHLGdCQUFnQixDQUNoQyxlQUFlLEVBQ2Ysa0JBQWtCLENBQUMsT0FBTyxFQUMxQixVQUFVLENBQ1gsQ0FBQztZQUNGLHVCQUFNLGtCQUFrQixHQUFHLHVCQUF1QixDQUNoRCxlQUFlLEVBQ2YsVUFBVSxDQUNYLENBQUM7WUFDRix1QkFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1lBQ3RCLEdBQUcsQ0FBQyxDQUFDLHFCQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDL0MsR0FBRyxDQUFDLENBQUMsdUJBQU0sV0FBVyxJQUFJLGtCQUFrQixDQUFDLENBQUMsQ0FBQztvQkFDN0MsVUFBVSxDQUFDLElBQUksQ0FBQzt3QkFDZCxJQUFJLEVBQUUsV0FBVyxDQUFDLElBQUk7d0JBQ3RCLElBQUksRUFBRSxTQUFTLENBQUMsUUFBUTt3QkFDeEIsSUFBSSxFQUFFLFdBQVcsQ0FBQyxJQUFJO3dCQUN0QixFQUFFLEVBQUUsV0FBVyxDQUFDLEdBQUc7cUJBQ3BCLENBQUMsQ0FBQztpQkFDSjthQUNGO1lBQ0QscUJBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztZQUNoQixFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMvQyxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDekQsTUFBTSxHQUFHLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztpQkFDaEQ7YUFDRjtZQUNELEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztTQUMxRDtRQUNELEdBQUcsQ0FBQyxDQUFDLHVCQUFNLE9BQU8sSUFBSSxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzlDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQzdCOztRQUdELHVCQUFNLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBQ3hELHVCQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUM5QixHQUFHLENBQUMsQ0FBQyxxQkFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxhQUFhLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN2Qyx1QkFBTSxlQUFlLEdBQUcsdUJBQXVCLENBQzdDLGVBQWUsRUFDZixrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQzlCLENBQUM7WUFDRixrQkFBa0IsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7U0FDMUM7UUFDRCxxQkFBSSxtQkFBbUIsR0FBRyxFQUFFLENBQUM7UUFDN0IsR0FBRyxDQUFDLENBQUMscUJBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDbkQsRUFBRSxDQUFDLENBQUMsbUJBQW1CLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLEdBQUcsQ0FBQyxDQUFDLHVCQUFNLElBQUksSUFBSSxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3pDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7aUJBQ2xDO2FBQ0Y7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTix1QkFBTSxRQUFRLEdBQUcsbUJBQW1CLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQzlDLG1CQUFtQixHQUFHLEVBQUUsQ0FBQztnQkFDekIsR0FBRyxDQUFDLENBQUMsdUJBQU0sSUFBSSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7b0JBQzVCLEdBQUcsQ0FBQyxDQUFDLHVCQUFNLEdBQUcsSUFBSSxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ3hDLEVBQUUsQ0FBQyxDQUFDLElBQUksWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDOzRCQUMxQix1QkFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzs0QkFDakMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQ2pEO3dCQUFDLElBQUksQ0FBQyxDQUFDOzRCQUNOLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO3lCQUN2QztxQkFDRjtpQkFDRjthQUNGO1NBQ0Y7O1FBR0QsdUJBQU0sV0FBVyxHQUFHLGtCQUFrQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDbkQsdUJBQU0sZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUMzQixHQUFHLENBQUMsQ0FBQyxxQkFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNyQyx1QkFBTSxTQUFTLEdBQUcsZ0JBQWdCLENBQ2hDLGVBQWUsRUFDZixrQkFBa0IsQ0FBQyxJQUFJLEVBQ3ZCLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDM0IsQ0FBQztZQUNGLHVCQUFNLGVBQWUsR0FBRyx1QkFBdUIsQ0FDN0MsZUFBZSxFQUNmLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FDM0IsQ0FBQztZQUNGLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1NBQ3pFO1FBQ0QscUJBQUksZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQzFCLEdBQUcsQ0FBQyxDQUFDLHFCQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGVBQWUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNoRCxFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsR0FBRyxDQUFDLENBQUMsdUJBQU0sSUFBSSxJQUFJLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUM1QyxJQUFJLENBQUMsVUFBVSxHQUFHLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7b0JBQ2hELGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7aUJBQy9CO2FBQ0Y7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTix1QkFBTSxRQUFRLEdBQUcsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQzNDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztnQkFDdEIsR0FBRyxDQUFDLENBQUMsdUJBQU0sSUFBSSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7b0JBQzVCLEdBQUcsQ0FBQyxDQUFDLHVCQUFNLEdBQUcsSUFBSSxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzt3QkFDM0MsR0FBRyxDQUFDLFVBQVUsR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO3dCQUMvQyxFQUFFLENBQUMsQ0FBQyxJQUFJLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDMUIsdUJBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7NEJBQ2pDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO3lCQUM5Qzt3QkFBQyxJQUFJLENBQUMsQ0FBQzs0QkFDTixnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQzt5QkFDcEM7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGO1FBRUQscUJBQUksT0FBTyxHQUFHLENBQUMsQ0FBQztRQUNoQixFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQyxHQUFHLENBQUMsQ0FBQyx1QkFBTSxPQUFPLElBQUksZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO2dCQUN2Qyx1QkFBTSxJQUFJLEdBQUc7b0JBQ1gsS0FBSyxFQUFFLEVBQUU7b0JBQ1QsT0FBTyxFQUFFLE9BQU87aUJBQ2pCLENBQUM7Z0JBQ0YsR0FBRyxDQUFDLENBQUMsdUJBQU0sR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBQzFCLEVBQUUsQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLElBQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsUUFBUSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQzdELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDOzRCQUNkLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSTs0QkFDZCxJQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUc7NEJBQ2IsR0FBRyxFQUFFLEdBQUcsQ0FBQyxJQUFJOzRCQUNiLFFBQVEsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLFFBQVE7NEJBQ2pDLE1BQU0sRUFBRSxJQUFJO3lCQUNiLENBQUMsQ0FBQztxQkFDSjtpQkFDRjtnQkFDRCxHQUFHLENBQUMsQ0FBQyx1QkFBTSxPQUFPLElBQUksbUJBQW1CLENBQUMsQ0FBQyxDQUFDO29CQUMxQyx1QkFBTSxRQUFRLEdBQUcsRUFBRSxDQUFDO29CQUNwQixHQUFHLENBQUMsQ0FBQyx1QkFBTSxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQzt3QkFDMUIsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztxQkFDbkQ7b0JBQ0QsR0FBRyxDQUFDLENBQUMsdUJBQU0sR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7d0JBQzFCLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7cUJBQ25EO29CQUNELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO3dCQUNkLElBQUksRUFBRSxFQUFFO3dCQUNSLEdBQUcsRUFBRSxZQUFZLENBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQzt3QkFDNUMsS0FBSyxFQUFFLGlCQUFpQixDQUN0QixhQUFhLEVBQ2IsWUFBWSxDQUFDLGVBQWUsRUFBRSxRQUFRLENBQUMsQ0FDeEM7d0JBQ0QsUUFBUSxFQUFFLEdBQUc7d0JBQ2IsT0FBTyxFQUFFLElBQUk7cUJBQ2QsQ0FBQyxDQUFDO2lCQUNKO2dCQUNELEVBQUUsQ0FBQyxDQUNELGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUM7b0JBQ2xELGtCQUFrQixDQUFDLGFBQ3JCLENBQUMsQ0FBQyxDQUFDO29CQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDNUQsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7cUJBQ3ZCO2lCQUNGO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUN2QjtnQkFFRCxPQUFPLEVBQUUsQ0FBQzthQUNYO1NBQ0Y7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLHVCQUFNLElBQUksR0FBRztnQkFDWCxLQUFLLEVBQUUsRUFBRTtnQkFDVCxPQUFPLEVBQUUsRUFBRTthQUNaLENBQUM7WUFDRixHQUFHLENBQUMsQ0FBQyx1QkFBTSxPQUFPLElBQUksbUJBQW1CLENBQUMsQ0FBQyxDQUFDO2dCQUMxQyx1QkFBTSxRQUFRLEdBQUcsRUFBRSxDQUFDO2dCQUNwQixHQUFHLENBQUMsQ0FBQyx1QkFBTSxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQztvQkFDMUIsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztpQkFDbkQ7Z0JBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7b0JBQ2QsSUFBSSxFQUFFLEVBQUU7b0JBQ1IsR0FBRyxFQUFFLFlBQVksQ0FBQyxlQUFlLEVBQUUsUUFBUSxDQUFDO29CQUM1QyxRQUFRLEVBQUUsR0FBRztvQkFDYixPQUFPLEVBQUUsSUFBSTtpQkFDZCxDQUFDLENBQUM7YUFDSjtZQUNELEVBQUUsQ0FBQyxDQUNELGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUM7Z0JBQ2xELGtCQUFrQixDQUFDLGFBQ3JCLENBQUMsQ0FBQyxDQUFDO2dCQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDNUQsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7aUJBQ3ZCO2FBQ0Y7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN2QjtTQUNGO0tBQ0Y7OztJQUlELE1BQU0sQ0FBQyxLQUFLLENBQUM7Q0FDZDs7Ozs7O0FBRUQsdUJBQXVCLHNCQUFzQixFQUFFLElBQVk7SUFDekQscUJBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNkLHFCQUFJLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFDaEIsR0FBRyxDQUFDLENBQUMsdUJBQU0sTUFBTSxJQUFJLHNCQUFzQixDQUFDLENBQUMsQ0FBQztRQUM1QyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDekIsS0FBSyxHQUFHLE9BQU8sQ0FBQztTQUNqQjtRQUNELE9BQU8sRUFBRSxDQUFDO0tBQ1g7SUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0NBQ2Q7Ozs7Ozs7QUFFRCwwQkFBMEIsZUFBZSxFQUFFLEtBQUssRUFBRSxJQUFJO0lBQ3BELHVCQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hDLHVCQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBQ2xDLHVCQUFNLFVBQVUsR0FBRyxZQUFZLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLHVCQUFNLFVBQVUsR0FBRyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsRUFBRSxDQUFDO0lBQ25ELEdBQUcsQ0FBQyxDQUFDLHFCQUFJLENBQUMsR0FBRyxVQUFVLEVBQUUsQ0FBQyxHQUFHLFdBQVcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzlDLHVCQUFNLEdBQUcsR0FBRyx1QkFBdUIsQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0QsVUFBVSxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7S0FDeEQ7SUFDRCxHQUFHLENBQUMsQ0FBQyxxQkFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNyQyx1QkFBTSxHQUFHLEdBQUcsdUJBQXVCLENBQUMsZUFBZSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9ELFVBQVUsQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO0tBQzlEO0lBQ0QsTUFBTSxDQUFDLFVBQVUsQ0FBQztDQUNuQjs7Ozs7OztBQUVELGlDQUNFLGdCQUFnQixFQUNoQixjQUFjLEVBQ2QsZUFBZSxHQUFHLEVBQUU7SUFFcEIsdUJBQU0sZUFBZSxHQUFHLHlCQUF5QixDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDcEUsdUJBQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNyQixFQUFFLENBQUMsQ0FBQyxlQUFlLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakMsR0FBRyxDQUFDLENBQUMsdUJBQU0sR0FBRyxJQUFJLGdCQUFnQixDQUFDLGVBQWUsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEUsU0FBUyxDQUFDLElBQUksQ0FBQztnQkFDYixJQUFJLEVBQUUsZUFBZSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO2dCQUN6QyxHQUFHLEVBQUUsR0FBRztnQkFDUixJQUFJLEVBQUUsY0FBYzthQUNyQixDQUFDLENBQUM7U0FDSjtLQUNGO0lBQ0QsRUFBRSxDQUFDLENBQUMsZUFBZSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLEdBQUcsQ0FBQyxDQUFDLHVCQUFNLEdBQUcsSUFBSSxlQUFlLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLFNBQVMsQ0FBQyxJQUFJLENBQUM7Z0JBQ2IsSUFBSSxFQUFFLGVBQWUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztnQkFDekMsR0FBRyxFQUFFLEdBQUc7Z0JBQ1IsSUFBSSxFQUFFLGNBQWM7YUFDckIsQ0FBQyxDQUFDO1NBQ0o7S0FDRjtJQUNELE1BQU0sQ0FBQyxTQUFTLENBQUM7Q0FDbEI7Ozs7O0FBRUQsbUNBQW1DLGVBQW9CO0lBQ3JELE1BQU0sQ0FBQyxlQUFlLENBQUM7Q0FDeEI7Ozs7OztBQUVELDBCQUEwQixlQUFlLEVBQUUsWUFBb0I7SUFDN0QscUJBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztJQUN2QixFQUFFLENBQUMsQ0FBQyxZQUFZLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMxQixhQUFhLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7S0FDN0M7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsWUFBWSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDakMsYUFBYSxHQUFHLGVBQWUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO0tBQzdDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFlBQVksS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLGFBQWEsR0FBRyxlQUFlLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztLQUM3QztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxZQUFZLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqQyxhQUFhLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7S0FDN0M7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLGFBQWEsR0FBRyxlQUFlLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO0tBQ3hEO0lBQ0QsTUFBTSxDQUFDLGFBQWEsQ0FBQztDQUN0Qjs7Ozs7O0FBRUQsc0JBQXNCLGVBQWUsRUFBRSxTQUFTLEdBQUcsRUFBRTtJQUNuRCxxQkFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDO0lBQ2YsR0FBRyxDQUFDLENBQUMsdUJBQU0sS0FBSyxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLHFCQUFJLE9BQU8sR0FBRyxDQUFDLENBQUM7UUFDaEIsR0FBRyxDQUFDLENBQUMsdUJBQU0sSUFBSSxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDN0IsRUFBRSxDQUFDLENBQ0QsS0FBSyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUNwRSxDQUFDLENBQUMsQ0FBQztnQkFDRCxPQUFPLEVBQUUsQ0FBQzthQUNYO1NBQ0Y7UUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLEtBQUssU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDakMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNsRSxHQUFHLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7YUFDOUQ7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixHQUFHLElBQUksVUFBVSxDQUNmLEtBQUssQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUN2RCxDQUFDO2FBQ0g7U0FDRjtLQUNGO0lBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQztDQUNaOzs7Ozs7QUFFRCwyQkFBMkIsYUFBYSxFQUFFLEtBQUs7SUFDN0MscUJBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUNmLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDbkMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUNsQyxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxJQUFJLEtBQUssSUFBSSxXQUFXLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3BFLEtBQUssR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDO2FBQzNCOzs7U0FLRixDQUFDLENBQUM7S0FDSjtJQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7Q0FDZDs7Ozs7O0FBRUQsb0JBQW9CLGNBQWMsRUFBRSxLQUFLO0lBQ3ZDLHFCQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDbkIsR0FBRyxDQUFDLENBQUMscUJBQUksQ0FBQyxHQUFHLGNBQWMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ25ELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssRUFBRSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqRCxPQUFPLEdBQUcsS0FBSyxDQUFDO1NBQ2pCO0tBQ0Y7SUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDO0NBQ2hCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGFibGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL3RhYmxlLWNvbmZpZ3VyYXRpb24nO1xuZXhwb3J0IGZ1bmN0aW9uIGRyYXdUYWJsZShcbiAgYW5hbHl0aWNzT2JqZWN0LFxuICB0YWJsZUNvbmZpZ3VyYXRpb246IFRhYmxlQ29uZmlndXJhdGlvblxuKSB7XG4gIGNvbnN0IGxlZ2VuZENsYXNzZXMgPSB0YWJsZUNvbmZpZ3VyYXRpb24ubGVnZW5kU2V0XG4gICAgPyB0YWJsZUNvbmZpZ3VyYXRpb24ubGVnZW5kU2V0LmxlZ2VuZHNcbiAgICA6IG51bGw7XG5cbiAgY29uc3QgdGFibGUgPSB7XG4gICAgaGVhZGVyczogW10sXG4gICAgY29sdW1uczogW10sXG4gICAgcm93czogW10sXG4gICAgdGl0bGVzOiB7XG4gICAgICByb3dzOiBbXSxcbiAgICAgIGNvbHVtbjogW11cbiAgICB9LFxuICAgIHRpdGxlc0F2YWlsYWJsZTogZmFsc2UsXG4gICAgaGFzUGFyZW50T3U6IGZhbHNlXG4gIH07XG4gIGlmICh0YWJsZUNvbmZpZ3VyYXRpb24uaGFzT3duUHJvcGVydHkoJ3RpdGxlJykpIHtcbiAgICB0YWJsZVsndGl0bGUnXSA9IHRhYmxlQ29uZmlndXJhdGlvbi50aXRsZTtcbiAgfVxuICBpZiAodGFibGVDb25maWd1cmF0aW9uLmhhc093blByb3BlcnR5KCdzdWJ0aXRsZScpKSB7XG4gICAgdGFibGVbJ3N1YnRpdGxlJ10gPSB0YWJsZUNvbmZpZ3VyYXRpb24uc3VidGl0bGU7XG4gIH1cbiAgaWYgKHRhYmxlQ29uZmlndXJhdGlvbi5kaXNwbGF5TGlzdCkge1xuICAgIHRhYmxlLmhlYWRlcnNbMF0gPSB7XG4gICAgICBpdGVtczogW10sXG4gICAgICBzdHlsZTogJydcbiAgICB9O1xuICAgIHRhYmxlQ29uZmlndXJhdGlvbi5jb2x1bW5zW3RhYmxlQ29uZmlndXJhdGlvbi5jb2x1bW5zLmluZGV4T2YoJ3BlJyldID1cbiAgICAgICdldmVudGRhdGUnO1xuICAgIHRhYmxlQ29uZmlndXJhdGlvbi5jb2x1bW5zW3RhYmxlQ29uZmlndXJhdGlvbi5jb2x1bW5zLmluZGV4T2YoJ291JyldID1cbiAgICAgICdvdW5hbWUnO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiB0YWJsZUNvbmZpZ3VyYXRpb24uY29sdW1ucykge1xuICAgICAgdGFibGUuaGVhZGVyc1swXS5pdGVtcy5wdXNoKHtcbiAgICAgICAgbmFtZTpcbiAgICAgICAgICBhbmFseXRpY3NPYmplY3QuaGVhZGVyc1tnZXRUaXRsZUluZGV4KGFuYWx5dGljc09iamVjdC5oZWFkZXJzLCBpdGVtKV1cbiAgICAgICAgICAgIC5jb2x1bW4sXG4gICAgICAgIHNwYW46IDFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYW5hbHl0aWNzT2JqZWN0LnJvd3MpIHtcbiAgICAgIGNvbnN0IGNvbHVtbl9pdGVtcyA9IFtdO1xuICAgICAgZm9yIChjb25zdCBjb2wgb2YgdGFibGVDb25maWd1cmF0aW9uLmNvbHVtbnMpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSBnZXRUaXRsZUluZGV4KGFuYWx5dGljc09iamVjdC5oZWFkZXJzLCBjb2wpO1xuICAgICAgICBjb2x1bW5faXRlbXMucHVzaCh7XG4gICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICByb3dfc3BhbjogJzEnLFxuICAgICAgICAgIC8vIGNvbG9yOmdldENvbG9yKGl0ZW1baW5kZXhdLClcbiAgICAgICAgICB2YWw6IGl0ZW1baW5kZXhdXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGFibGUucm93cy5wdXNoKHtcbiAgICAgICAgaGVhZGVyczogW10sXG4gICAgICAgIGl0ZW1zOiBjb2x1bW5faXRlbXNcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBhZGQgbmFtZXMgdG8gdGl0bGVzIGFycmF5XG4gICAgaWYgKHRhYmxlQ29uZmlndXJhdGlvbi5zaG93RGltZW5zaW9uTGFiZWxzKSB7XG4gICAgICB0YWJsZS50aXRsZXNBdmFpbGFibGUgPSB0cnVlO1xuICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRhYmxlQ29uZmlndXJhdGlvbi5jb2x1bW5zKSB7XG4gICAgICAgIHRhYmxlLnRpdGxlcy5jb2x1bW4ucHVzaChcbiAgICAgICAgICBhbmFseXRpY3NPYmplY3QuaGVhZGVyc1tnZXRUaXRsZUluZGV4KGFuYWx5dGljc09iamVjdC5oZWFkZXJzLCBpdGVtKV1cbiAgICAgICAgICAgIC5jb2x1bW5cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0YWJsZUNvbmZpZ3VyYXRpb24ucm93cykge1xuICAgICAgICB0YWJsZS50aXRsZXMucm93cy5wdXNoKFxuICAgICAgICAgIGFuYWx5dGljc09iamVjdC5oZWFkZXJzW2dldFRpdGxlSW5kZXgoYW5hbHl0aWNzT2JqZWN0LmhlYWRlcnMsIGl0ZW0pXVxuICAgICAgICAgICAgLmNvbHVtblxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGNvbnN0IGNvbHVtbkl0ZW0gb2YgdGFibGVDb25maWd1cmF0aW9uLmNvbHVtbnMpIHtcbiAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IGNhbGN1bGF0ZUNvbFNwYW4oXG4gICAgICAgIGFuYWx5dGljc09iamVjdCxcbiAgICAgICAgdGFibGVDb25maWd1cmF0aW9uLmNvbHVtbnMsXG4gICAgICAgIGNvbHVtbkl0ZW1cbiAgICAgICk7XG4gICAgICBjb25zdCBjdXJyZW50Q29sdW1uSXRlbXMgPSBwcmVwYXJlU2luZ2xlQ2F0ZWdvcmllcyhcbiAgICAgICAgYW5hbHl0aWNzT2JqZWN0LFxuICAgICAgICBjb2x1bW5JdGVtXG4gICAgICApO1xuICAgICAgY29uc3QgaGVhZGVySXRlbSA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaW1lbnNpb24uZHVwbGljYXRpb247IGkrKykge1xuICAgICAgICBmb3IgKGNvbnN0IGN1cnJlbnRJdGVtIG9mIGN1cnJlbnRDb2x1bW5JdGVtcykge1xuICAgICAgICAgIGhlYWRlckl0ZW0ucHVzaCh7XG4gICAgICAgICAgICBuYW1lOiBjdXJyZW50SXRlbS5uYW1lLFxuICAgICAgICAgICAgc3BhbjogZGltZW5zaW9uLmNvbF9zcGFuLFxuICAgICAgICAgICAgdHlwZTogY3VycmVudEl0ZW0udHlwZSxcbiAgICAgICAgICAgIGlkOiBjdXJyZW50SXRlbS51aWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGV0IHN0eWxlcyA9ICcnO1xuICAgICAgaWYgKHRhYmxlQ29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eSgnc3R5bGUnKSkge1xuICAgICAgICBpZiAodGFibGVDb25maWd1cmF0aW9uLnN0eWxlcy5oYXNPd25Qcm9wZXJ0eShjb2x1bW5JdGVtKSkge1xuICAgICAgICAgIHN0eWxlcyA9IHRhYmxlQ29uZmlndXJhdGlvbi5zdHlsZXNbY29sdW1uSXRlbV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRhYmxlLmhlYWRlcnMucHVzaCh7IGl0ZW1zOiBoZWFkZXJJdGVtLCBzdHlsZTogc3R5bGVzIH0pO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHJvd0l0ZW0gb2YgdGFibGVDb25maWd1cmF0aW9uLnJvd3MpIHtcbiAgICAgIHRhYmxlLmNvbHVtbnMucHVzaChyb3dJdGVtKTtcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJpbmcgdGFibGUgY29sdW1uc1xuICAgIGNvbnN0IGNvbHVtbl9sZW5ndGggPSB0YWJsZUNvbmZpZ3VyYXRpb24uY29sdW1ucy5sZW5ndGg7XG4gICAgY29uc3QgY29sdW1uX2l0ZW1zX2FycmF5ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2x1bW5fbGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRSb3dJdGVtcyA9IHByZXBhcmVTaW5nbGVDYXRlZ29yaWVzKFxuICAgICAgICBhbmFseXRpY3NPYmplY3QsXG4gICAgICAgIHRhYmxlQ29uZmlndXJhdGlvbi5jb2x1bW5zW2ldXG4gICAgICApO1xuICAgICAgY29sdW1uX2l0ZW1zX2FycmF5LnB1c2goY3VycmVudFJvd0l0ZW1zKTtcbiAgICB9XG4gICAgbGV0IHRhYmxlX2NvbHVtbnNfYXJyYXkgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbHVtbl9pdGVtc19hcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRhYmxlX2NvbHVtbnNfYXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBjb2x1bW5faXRlbXNfYXJyYXlbaV0pIHtcbiAgICAgICAgICB0YWJsZV9jb2x1bW5zX2FycmF5LnB1c2goW2l0ZW1dKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgdGVtcF9hcnIgPSB0YWJsZV9jb2x1bW5zX2FycmF5LmNvbmNhdCgpO1xuICAgICAgICB0YWJsZV9jb2x1bW5zX2FycmF5ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0ZW1wX2Fycikge1xuICAgICAgICAgIGZvciAoY29uc3QgdmFsIG9mIGNvbHVtbl9pdGVtc19hcnJheVtpXSkge1xuICAgICAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICBjb25zdCB0ZW1wQXJyID0gQXJyYXkuZnJvbShpdGVtKTtcbiAgICAgICAgICAgICAgdGFibGVfY29sdW1uc19hcnJheS5wdXNoKHRlbXBBcnIuY29uY2F0KFt2YWxdKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0YWJsZV9jb2x1bW5zX2FycmF5LnB1c2goW2l0ZW0sIHZhbF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFByZXBhcmluZyB0YWJsZSByb3dzXG4gICAgY29uc3Qgcm93c19sZW5ndGggPSB0YWJsZUNvbmZpZ3VyYXRpb24ucm93cy5sZW5ndGg7XG4gICAgY29uc3Qgcm93X2l0ZW1zX2FycmF5ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dzX2xlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBkaW1lbnNpb24gPSBjYWxjdWxhdGVDb2xTcGFuKFxuICAgICAgICBhbmFseXRpY3NPYmplY3QsXG4gICAgICAgIHRhYmxlQ29uZmlndXJhdGlvbi5yb3dzLFxuICAgICAgICB0YWJsZUNvbmZpZ3VyYXRpb24ucm93c1tpXVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRSb3dJdGVtcyA9IHByZXBhcmVTaW5nbGVDYXRlZ29yaWVzKFxuICAgICAgICBhbmFseXRpY3NPYmplY3QsXG4gICAgICAgIHRhYmxlQ29uZmlndXJhdGlvbi5yb3dzW2ldXG4gICAgICApO1xuICAgICAgcm93X2l0ZW1zX2FycmF5LnB1c2goeyBpdGVtczogY3VycmVudFJvd0l0ZW1zLCBkaW1lbnNpb25zOiBkaW1lbnNpb24gfSk7XG4gICAgfVxuICAgIGxldCB0YWJsZV9yb3dzX2FycmF5ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dfaXRlbXNfYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0YWJsZV9yb3dzX2FycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2Ygcm93X2l0ZW1zX2FycmF5W2ldLml0ZW1zKSB7XG4gICAgICAgICAgaXRlbS5kaW1lbnNpb25zID0gcm93X2l0ZW1zX2FycmF5W2ldLmRpbWVuc2lvbnM7XG4gICAgICAgICAgdGFibGVfcm93c19hcnJheS5wdXNoKFtpdGVtXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHRlbXBfYXJyID0gdGFibGVfcm93c19hcnJheS5jb25jYXQoKTtcbiAgICAgICAgdGFibGVfcm93c19hcnJheSA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGVtcF9hcnIpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IHZhbCBvZiByb3dfaXRlbXNfYXJyYXlbaV0uaXRlbXMpIHtcbiAgICAgICAgICAgIHZhbC5kaW1lbnNpb25zID0gcm93X2l0ZW1zX2FycmF5W2ldLmRpbWVuc2lvbnM7XG4gICAgICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgIGNvbnN0IHRlbXBBcnIgPSBBcnJheS5mcm9tKGl0ZW0pO1xuICAgICAgICAgICAgICB0YWJsZV9yb3dzX2FycmF5LnB1c2godGVtcEFyci5jb25jYXQoW3ZhbF0pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRhYmxlX3Jvd3NfYXJyYXkucHVzaChbaXRlbSwgdmFsXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IGNvdW50ZXIgPSAwO1xuICAgIGlmICh0YWJsZV9yb3dzX2FycmF5Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgZm9yIChjb25zdCByb3dJdGVtIG9mIHRhYmxlX3Jvd3NfYXJyYXkpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHtcbiAgICAgICAgICBpdGVtczogW10sXG4gICAgICAgICAgaGVhZGVyczogcm93SXRlbVxuICAgICAgICB9O1xuICAgICAgICBmb3IgKGNvbnN0IHZhbCBvZiByb3dJdGVtKSB7XG4gICAgICAgICAgaWYgKGNvdW50ZXIgPT09IDAgfHwgY291bnRlciAlIHZhbC5kaW1lbnNpb25zLmNvbF9zcGFuID09PSAwKSB7XG4gICAgICAgICAgICBpdGVtLml0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICB0eXBlOiB2YWwudHlwZSxcbiAgICAgICAgICAgICAgbmFtZTogdmFsLnVpZCxcbiAgICAgICAgICAgICAgdmFsOiB2YWwubmFtZSxcbiAgICAgICAgICAgICAgcm93X3NwYW46IHZhbC5kaW1lbnNpb25zLmNvbF9zcGFuLFxuICAgICAgICAgICAgICBoZWFkZXI6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNvbEl0ZW0gb2YgdGFibGVfY29sdW1uc19hcnJheSkge1xuICAgICAgICAgIGNvbnN0IGRhdGFJdGVtID0gW107XG4gICAgICAgICAgZm9yIChjb25zdCB2YWwgb2Ygcm93SXRlbSkge1xuICAgICAgICAgICAgZGF0YUl0ZW0ucHVzaCh7IHR5cGU6IHZhbC50eXBlLCB2YWx1ZTogdmFsLnVpZCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCB2YWwgb2YgY29sSXRlbSkge1xuICAgICAgICAgICAgZGF0YUl0ZW0ucHVzaCh7IHR5cGU6IHZhbC50eXBlLCB2YWx1ZTogdmFsLnVpZCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaXRlbS5pdGVtcy5wdXNoKHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgdmFsOiBnZXREYXRhVmFsdWUoYW5hbHl0aWNzT2JqZWN0LCBkYXRhSXRlbSksXG4gICAgICAgICAgICBjb2xvcjogZ2V0RGF0YVZhbHVlQ29sb3IoXG4gICAgICAgICAgICAgIGxlZ2VuZENsYXNzZXMsXG4gICAgICAgICAgICAgIGdldERhdGFWYWx1ZShhbmFseXRpY3NPYmplY3QsIGRhdGFJdGVtKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHJvd19zcGFuOiAnMScsXG4gICAgICAgICAgICBkaXNwbGF5OiB0cnVlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRhYmxlQ29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eSgnaGlkZUVtcHR5Um93cycpICYmXG4gICAgICAgICAgdGFibGVDb25maWd1cmF0aW9uLmhpZGVFbXB0eVJvd3NcbiAgICAgICAgKSB7XG4gICAgICAgICAgaWYgKCFjaGVja1plcm9zKHRhYmxlQ29uZmlndXJhdGlvbi5yb3dzLmxlbmd0aCwgaXRlbS5pdGVtcykpIHtcbiAgICAgICAgICAgIHRhYmxlLnJvd3MucHVzaChpdGVtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFibGUucm93cy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY291bnRlcisrO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBpdGVtID0ge1xuICAgICAgICBpdGVtczogW10sXG4gICAgICAgIGhlYWRlcnM6IFtdXG4gICAgICB9O1xuICAgICAgZm9yIChjb25zdCBjb2xJdGVtIG9mIHRhYmxlX2NvbHVtbnNfYXJyYXkpIHtcbiAgICAgICAgY29uc3QgZGF0YUl0ZW0gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCB2YWwgb2YgY29sSXRlbSkge1xuICAgICAgICAgIGRhdGFJdGVtLnB1c2goeyB0eXBlOiB2YWwudHlwZSwgdmFsdWU6IHZhbC51aWQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5pdGVtcy5wdXNoKHtcbiAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICB2YWw6IGdldERhdGFWYWx1ZShhbmFseXRpY3NPYmplY3QsIGRhdGFJdGVtKSxcbiAgICAgICAgICByb3dfc3BhbjogJzEnLFxuICAgICAgICAgIGRpc3BsYXk6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIHRhYmxlQ29uZmlndXJhdGlvbi5oYXNPd25Qcm9wZXJ0eSgnaGlkZUVtcHR5Um93cycpICYmXG4gICAgICAgIHRhYmxlQ29uZmlndXJhdGlvbi5oaWRlRW1wdHlSb3dzXG4gICAgICApIHtcbiAgICAgICAgaWYgKCFjaGVja1plcm9zKHRhYmxlQ29uZmlndXJhdGlvbi5yb3dzLmxlbmd0aCwgaXRlbS5pdGVtcykpIHtcbiAgICAgICAgICB0YWJsZS5yb3dzLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhYmxlLnJvd3MucHVzaChpdGVtKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyB0b2RvIGltcHJvdmUgdG90YWwgb3B0aW9ucyB0byBhbHNvIHdvcmsgZm9yIGV2ZW50IHRhYmxlXG4gIC8vIHJldHVybiBfZ2V0U2FuaXRpemVkVGFibGVPYmplY3QodGFibGUsIHRhYmxlQ29uZmlndXJhdGlvbik7XG4gIHJldHVybiB0YWJsZTtcbn1cblxuZnVuY3Rpb24gZ2V0VGl0bGVJbmRleChhbmFseXRpY3NPYmplY3RIZWFkZXJzLCBuYW1lOiBzdHJpbmcpIHtcbiAgbGV0IGluZGV4ID0gMDtcbiAgbGV0IGNvdW50ZXIgPSAwO1xuICBmb3IgKGNvbnN0IGhlYWRlciBvZiBhbmFseXRpY3NPYmplY3RIZWFkZXJzKSB7XG4gICAgaWYgKGhlYWRlci5uYW1lID09PSBuYW1lKSB7XG4gICAgICBpbmRleCA9IGNvdW50ZXI7XG4gICAgfVxuICAgIGNvdW50ZXIrKztcbiAgfVxuICByZXR1cm4gaW5kZXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUNvbFNwYW4oYW5hbHl0aWNzT2JqZWN0LCBhcnJheSwgaXRlbSkge1xuICBjb25zdCBpbmRleE9mSXRlbSA9IGFycmF5LmluZGV4T2YoaXRlbSk7XG4gIGNvbnN0IGFycmF5X2xlbmd0aCA9IGFycmF5Lmxlbmd0aDtcbiAgY29uc3QgbGFzdF9pbmRleCA9IGFycmF5X2xlbmd0aCAtIDE7XG4gIGNvbnN0IGRpbWVuc2lvbnMgPSB7IGNvbF9zcGFuOiAxLCBkdXBsaWNhdGlvbjogMSB9O1xuICBmb3IgKGxldCBpID0gbGFzdF9pbmRleDsgaSA+IGluZGV4T2ZJdGVtOyBpLS0pIHtcbiAgICBjb25zdCBhcnIgPSBwcmVwYXJlU2luZ2xlQ2F0ZWdvcmllcyhhbmFseXRpY3NPYmplY3QsIGFycmF5W2ldKTtcbiAgICBkaW1lbnNpb25zLmNvbF9zcGFuID0gZGltZW5zaW9ucy5jb2xfc3BhbiAqIGFyci5sZW5ndGg7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleE9mSXRlbTsgaSsrKSB7XG4gICAgY29uc3QgYXJyID0gcHJlcGFyZVNpbmdsZUNhdGVnb3JpZXMoYW5hbHl0aWNzT2JqZWN0LCBhcnJheVtpXSk7XG4gICAgZGltZW5zaW9ucy5kdXBsaWNhdGlvbiA9IGRpbWVuc2lvbnMuZHVwbGljYXRpb24gKiBhcnIubGVuZ3RoO1xuICB9XG4gIHJldHVybiBkaW1lbnNpb25zO1xufVxuXG5mdW5jdGlvbiBwcmVwYXJlU2luZ2xlQ2F0ZWdvcmllcyhcbiAgaW5pdGlhbEFuYWx5dGljcyxcbiAgaXRlbUlkZW50aWZpZXIsXG4gIHByZURlZmluZWRJdGVtcyA9IFtdXG4pIHtcbiAgY29uc3QgYW5hbHl0aWNzT2JqZWN0ID0gc2FuaXRpemVJbmNvbWluZ0FuYWx5dGljcyhpbml0aWFsQW5hbHl0aWNzKTtcbiAgY29uc3Qgc3RydWN0dXJlID0gW107XG4gIGlmIChwcmVEZWZpbmVkSXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgZm9yIChjb25zdCB2YWwgb2YgZ2V0TWV0YWRhdGFBcnJheShhbmFseXRpY3NPYmplY3QsIGl0ZW1JZGVudGlmaWVyKSkge1xuICAgICAgc3RydWN0dXJlLnB1c2goe1xuICAgICAgICBuYW1lOiBhbmFseXRpY3NPYmplY3QubWV0YURhdGEubmFtZXNbdmFsXSxcbiAgICAgICAgdWlkOiB2YWwsXG4gICAgICAgIHR5cGU6IGl0ZW1JZGVudGlmaWVyXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgaWYgKHByZURlZmluZWRJdGVtcy5sZW5ndGggIT09IDApIHtcbiAgICBmb3IgKGNvbnN0IHZhbCBvZiBwcmVEZWZpbmVkSXRlbXMpIHtcbiAgICAgIHN0cnVjdHVyZS5wdXNoKHtcbiAgICAgICAgbmFtZTogYW5hbHl0aWNzT2JqZWN0Lm1ldGFEYXRhLm5hbWVzW3ZhbF0sXG4gICAgICAgIHVpZDogdmFsLFxuICAgICAgICB0eXBlOiBpdGVtSWRlbnRpZmllclxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzdHJ1Y3R1cmU7XG59XG5cbmZ1bmN0aW9uIHNhbml0aXplSW5jb21pbmdBbmFseXRpY3MoYW5hbHl0aWNzT2JqZWN0OiBhbnkpIHtcbiAgcmV0dXJuIGFuYWx5dGljc09iamVjdDtcbn1cblxuZnVuY3Rpb24gZ2V0TWV0YWRhdGFBcnJheShhbmFseXRpY3NPYmplY3QsIG1ldGFkYXRhVHlwZTogc3RyaW5nKSB7XG4gIGxldCBtZXRhZGF0YUFycmF5ID0gW107XG4gIGlmIChtZXRhZGF0YVR5cGUgPT09ICdkeCcpIHtcbiAgICBtZXRhZGF0YUFycmF5ID0gYW5hbHl0aWNzT2JqZWN0Lm1ldGFEYXRhLmR4O1xuICB9IGVsc2UgaWYgKG1ldGFkYXRhVHlwZSA9PT0gJ291Jykge1xuICAgIG1ldGFkYXRhQXJyYXkgPSBhbmFseXRpY3NPYmplY3QubWV0YURhdGEub3U7XG4gIH0gZWxzZSBpZiAobWV0YWRhdGFUeXBlID09PSAnY28nKSB7XG4gICAgbWV0YWRhdGFBcnJheSA9IGFuYWx5dGljc09iamVjdC5tZXRhRGF0YS5jbztcbiAgfSBlbHNlIGlmIChtZXRhZGF0YVR5cGUgPT09ICdwZScpIHtcbiAgICBtZXRhZGF0YUFycmF5ID0gYW5hbHl0aWNzT2JqZWN0Lm1ldGFEYXRhLnBlO1xuICB9IGVsc2Uge1xuICAgIG1ldGFkYXRhQXJyYXkgPSBhbmFseXRpY3NPYmplY3QubWV0YURhdGFbbWV0YWRhdGFUeXBlXTtcbiAgfVxuICByZXR1cm4gbWV0YWRhdGFBcnJheTtcbn1cblxuZnVuY3Rpb24gZ2V0RGF0YVZhbHVlKGFuYWx5dGljc09iamVjdCwgZGF0YUl0ZW1zID0gW10pIHtcbiAgbGV0IG51bSA9IG51bGw7XG4gIGZvciAoY29uc3QgdmFsdWUgb2YgYW5hbHl0aWNzT2JqZWN0LnJvd3MpIHtcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGRhdGFJdGVtcykge1xuICAgICAgaWYgKFxuICAgICAgICB2YWx1ZVtnZXRUaXRsZUluZGV4KGFuYWx5dGljc09iamVjdC5oZWFkZXJzLCBpdGVtLnR5cGUpXSA9PT0gaXRlbS52YWx1ZVxuICAgICAgKSB7XG4gICAgICAgIGNvdW50ZXIrKztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvdW50ZXIgPT09IGRhdGFJdGVtcy5sZW5ndGgpIHtcbiAgICAgIGlmIChpc05hTih2YWx1ZVtnZXRUaXRsZUluZGV4KGFuYWx5dGljc09iamVjdC5oZWFkZXJzLCAndmFsdWUnKV0pKSB7XG4gICAgICAgIG51bSA9IHZhbHVlW2dldFRpdGxlSW5kZXgoYW5hbHl0aWNzT2JqZWN0LmhlYWRlcnMsICd2YWx1ZScpXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG51bSArPSBwYXJzZUZsb2F0KFxuICAgICAgICAgIHZhbHVlW2dldFRpdGxlSW5kZXgoYW5hbHl0aWNzT2JqZWN0LmhlYWRlcnMsICd2YWx1ZScpXVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gbnVtO1xufVxuXG5mdW5jdGlvbiBnZXREYXRhVmFsdWVDb2xvcihsZWdlbmRDbGFzc2VzLCB2YWx1ZSkge1xuICBsZXQgY29sb3IgPSAnJztcbiAgaWYgKCFpc05hTih2YWx1ZSkgJiYgbGVnZW5kQ2xhc3Nlcykge1xuICAgIGxlZ2VuZENsYXNzZXMuZm9yRWFjaChsZWdlbmRDbGFzcyA9PiB7XG4gICAgICBpZiAobGVnZW5kQ2xhc3Muc3RhcnRWYWx1ZSA8PSB2YWx1ZSAmJiBsZWdlbmRDbGFzcy5lbmRWYWx1ZSA+IHZhbHVlKSB7XG4gICAgICAgIGNvbG9yID0gbGVnZW5kQ2xhc3MuY29sb3I7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIChsZWdlbmRDbGFzcy5zdGFydFZhbHVlIDwgdmFsdWUgJiYgbGVnZW5kQ2xhc3MuZW5kVmFsdWUgPj0gdmFsdWUpIHtcbiAgICAgIFxuICAgICAgLy8gfVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBjb2xvcjtcbn1cblxuZnVuY3Rpb24gY2hlY2taZXJvcyhzdGF0aW5nX2xlbmd0aCwgYXJyYXkpOiBib29sZWFuIHtcbiAgbGV0IGNoZWNrZXIgPSB0cnVlO1xuICBmb3IgKGxldCBpID0gc3RhdGluZ19sZW5ndGg7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgIGlmIChhcnJheVtpXS5uYW1lID09PSAnJyAmJiBhcnJheVtpXS52YWwgIT0gbnVsbCkge1xuICAgICAgY2hlY2tlciA9IGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY2hlY2tlcjtcbn1cbiJdfQ==