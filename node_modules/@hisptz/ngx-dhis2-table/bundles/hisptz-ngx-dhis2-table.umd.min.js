!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@hisptz/ngx-dhis2-table",["exports","@angular/core","@angular/common"],t):t((e.hisptz=e.hisptz||{},e.hisptz["ngx-dhis2-table"]={}),e.ng.core,e.ng.common)}(this,function(e,t,r){"use strict";function Lt(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function Pt(e,t){var r,n,a=0,l=0;try{for(var o=Lt(e),i=o.next();!i.done;i=o.next()){i.value.name===t&&(a=l),l++}}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o["return"])&&n.call(o)}finally{if(r)throw r.error}}return a}function Dt(e,t,r){for(var n=t.indexOf(r),a={col_span:1,duplication:1},l=t.length-1;n<l;l--){var o=It(e,t[l]);a.col_span=a.col_span*o.length}for(l=0;l<n;l++){o=It(e,t[l]);a.duplication=a.duplication*o.length}return a}function It(e,t,r){void 0===r&&(r=[]);var n,a,l,o,i=function s(e){return e}(e),c=[];if(0===r.length)try{for(var u=Lt(function h(e,t){var r=[];r="dx"===t?e.metaData.dx:"ou"===t?e.metaData.ou:"co"===t?e.metaData.co:"pe"===t?e.metaData.pe:e.metaData[t];return r}(i,t)),d=u.next();!d.done;d=u.next()){var y=d.value;c.push({name:i.metaData.names[y],uid:y,type:t})}}catch(m){n={error:m}}finally{try{d&&!d.done&&(a=u["return"])&&a.call(u)}finally{if(n)throw n.error}}if(0!==r.length)try{for(var f=Lt(r),p=f.next();!p.done;p=f.next()){y=p.value;c.push({name:i.metaData.names[y],uid:y,type:t})}}catch(b){l={error:b}}finally{try{p&&!p.done&&(o=f["return"])&&o.call(f)}finally{if(l)throw l.error}}return c}function Ct(e,t){void 0===t&&(t=[]);var r,n,a,l,o=null;try{for(var i=Lt(e.rows),s=i.next();!s.done;s=i.next()){var c=s.value,u=0;try{for(var h=Lt(t),d=h.next();!d.done;d=h.next()){var y=d.value;c[Pt(e.headers,y.type)]===y.value&&u++}}catch(f){a={error:f}}finally{try{d&&!d.done&&(l=h["return"])&&l.call(h)}finally{if(a)throw a.error}}u===t.length&&(isNaN(c[Pt(e.headers,"value")])?o=c[Pt(e.headers,"value")]:o+=parseFloat(c[Pt(e.headers,"value")]))}}catch(p){r={error:p}}finally{try{s&&!s.done&&(n=i["return"])&&n.call(i)}finally{if(r)throw r.error}}return o}function Et(e,t){var r="";return!isNaN(t)&&e&&e.forEach(function(e){e.startValue<=t&&e.endValue>t&&(r=e.color)}),r}function Nt(e,t){for(var r=!0,n=e;n<t.length;n++)""===t[n].name&&null!=t[n].val&&(r=!1);return r}var n=function(){function e(){this.tableLayers=[]}return e.prototype.ngOnInit=function(){var r=this;this.visualizationLayers&&0<this.visualizationLayers.length&&(this.tableLayers=this.visualizationLayers.map(function(e){return{tableConfiguration:function t(e,t,r){return{title:e.hasOwnProperty("displayName")?e.displayName:e.hasOwnProperty("name")?e.name:"",subtitle:e.hasOwnProperty("subtitle")?e.subtitle:"",showColumnTotal:!e.hasOwnProperty("colTotal")||e.colTotal,showColumnSubtotal:!e.hasOwnProperty("colSubtotal")||e.colSubtotal,showRowTotal:!e.hasOwnProperty("rowTotal")||e.rowTotal,showRowSubtotal:!e.hasOwnProperty("rowSubtotal")||e.rowSubtotal,showDimensionLabels:!e.hasOwnProperty("showDimensionLabels")||e.showDimensionLabels,hideEmptyRows:!e.hasOwnProperty("hideEmptyRows")||e.hideEmptyRows,showHierarchy:!e.hasOwnProperty("showHierarchy")||e.showHierarchy,displayList:function n(e,t){var r=!1;return"EVENT_REPORT"===t&&e.hasOwnProperty("dataType")&&"EVENTS"===e.dataType&&(r=!0),r}(e,r),rows:t.rows?t.rows:["pe"],columns:t.columns?t.columns:["dx"],legendSet:e.legendSet||null,styles:null}}(e.config||{},e.layout,r.visualizationType),analyticsObject:e.analytics}}))},e.decorators=[{type:t.Component,args:[{selector:"ngx-dhis2-table-list",template:'<div class="row">\n    <div class="col-12" *ngFor="let tableLayer of tableLayers">\n        <ngx-dhis2-table-item [analyticsObject]="tableLayer.analyticsObject" [tableConfiguration]="tableLayer.tableConfiguration">\n        </ngx-dhis2-table-item>\n    </div>\n</div>',styles:[""]}]}],e.ctorParameters=function(){return[]},e.propDecorators={visualizationLayers:[{type:t.Input}],visualizationType:[{type:t.Input}]},e}(),a=function(){function e(){this.sort_direction=[],this.current_sorting=[],this.tableObject=null}return e.prototype.ngOnInit=function(){this.analyticsObject&&this.tableConfiguration&&(this.tableObject=function e(e,t){var r,n,a,l,o,i,s,c,u,h,d,y,f,p,m,b,v,g,w,x,O,j,_,T,L,P,D,I,C,E,N,M,S,F,H,z,R,k,A,B,V,q,G=t.legendSet?t.legendSet.legends:null,J={headers:[],columns:[],rows:[],titles:{rows:[],column:[]},titlesAvailable:!1,hasParentOu:!1};if(t.hasOwnProperty("title")&&(J.title=t.title),t.hasOwnProperty("subtitle")&&(J.subtitle=t.subtitle),t.displayList){J.headers[0]={items:[],style:""},t.columns[t.columns.indexOf("pe")]="eventdate",t.columns[t.columns.indexOf("ou")]="ouname";try{for(var K=Lt(t.columns),Q=K.next();!Q.done;Q=K.next()){var U=Q.value;J.headers[0].items.push({name:e.headers[Pt(e.headers,U)].column,span:1})}}catch(lt){r={error:lt}}finally{try{Q&&!Q.done&&(n=K["return"])&&n.call(K)}finally{if(r)throw r.error}}try{for(var W=Lt(e.rows),X=W.next();!X.done;X=W.next()){U=X.value;var Y=[];try{for(var Z=Lt(t.columns),$=Z.next();!$.done;$=Z.next()){var ee=$.value,te=Pt(e.headers,ee);Y.push({name:"",display:!0,row_span:"1",val:U[te]})}}catch(ot){o={error:ot}}finally{try{$&&!$.done&&(i=Z["return"])&&i.call(Z)}finally{if(o)throw o.error}}J.rows.push({headers:[],items:Y})}}catch(it){a={error:it}}finally{try{X&&!X.done&&(l=W["return"])&&l.call(W)}finally{if(a)throw a.error}}}else{if(t.showDimensionLabels){J.titlesAvailable=!0;try{for(var re=Lt(t.columns),ne=re.next();!ne.done;ne=re.next())U=ne.value,J.titles.column.push(e.headers[Pt(e.headers,U)].column)}catch(st){s={error:st}}finally{try{ne&&!ne.done&&(c=re["return"])&&c.call(re)}finally{if(s)throw s.error}}try{for(var ae=Lt(t.rows),le=ae.next();!le.done;le=ae.next())U=le.value,J.titles.rows.push(e.headers[Pt(e.headers,U)].column)}catch(ct){u={error:ct}}finally{try{le&&!le.done&&(h=ae["return"])&&h.call(ae)}finally{if(u)throw u.error}}}try{for(var oe=Lt(t.columns),ie=oe.next();!ie.done;ie=oe.next()){for(var se=ie.value,ce=Dt(e,t.columns,se),ue=It(e,se),he=[],de=0;de<ce.duplication;de++)try{for(var ye=Lt(ue),fe=ye.next();!fe.done;fe=ye.next()){var pe=fe.value;he.push({name:pe.name,span:ce.col_span,type:pe.type,id:pe.uid})}}catch(ut){f={error:ut}}finally{try{fe&&!fe.done&&(p=ye["return"])&&p.call(ye)}finally{if(f)throw f.error}}var me="";t.hasOwnProperty("style")&&t.styles.hasOwnProperty(se)&&(me=t.styles[se]),J.headers.push({items:he,style:me})}}catch(ht){d={error:ht}}finally{try{ie&&!ie.done&&(y=oe["return"])&&y.call(oe)}finally{if(d)throw d.error}}try{for(var be=Lt(t.rows),ve=be.next();!ve.done;ve=be.next()){var ge=ve.value;J.columns.push(ge)}}catch(dt){m={error:dt}}finally{try{ve&&!ve.done&&(b=be["return"])&&b.call(be)}finally{if(m)throw m.error}}var we=t.columns.length,xe=[];for(de=0;de<we;de++){var Oe=It(e,t.columns[de]);xe.push(Oe)}var je=[];for(de=0;de<xe.length;de++)if(0===je.length)try{for(var _e=Lt(xe[de]),Te=_e.next();!Te.done;Te=_e.next())U=Te.value,je.push([U])}catch(yt){v={error:yt}}finally{try{Te&&!Te.done&&(g=_e["return"])&&g.call(_e)}finally{if(v)throw v.error}}else{var Le=je.concat();je=[];try{for(var Pe=Lt(Le),De=Pe.next();!De.done;De=Pe.next()){U=De.value;try{for(var Ie=Lt(xe[de]),Ce=Ie.next();!Ce.done;Ce=Ie.next()){var Ee=Ce.value;if(U instanceof Array){var Ne=Array.from(U);je.push(Ne.concat([Ee]))}else je.push([U,Ee])}}catch(ft){O={error:ft}}finally{try{Ce&&!Ce.done&&(j=Ie["return"])&&j.call(Ie)}finally{if(O)throw O.error}}}}catch(pt){w={error:pt}}finally{try{De&&!De.done&&(x=Pe["return"])&&x.call(Pe)}finally{if(w)throw w.error}}}var Me=t.rows.length,Se=[];for(de=0;de<Me;de++)ce=Dt(e,t.rows,t.rows[de]),Oe=It(e,t.rows[de]),Se.push({items:Oe,dimensions:ce});var Fe=[];for(de=0;de<Se.length;de++)if(0===Fe.length)try{for(var He=Lt(Se[de].items),ze=He.next();!ze.done;ze=He.next())(U=ze.value).dimensions=Se[de].dimensions,Fe.push([U])}catch(mt){_={error:mt}}finally{try{ze&&!ze.done&&(T=He["return"])&&T.call(He)}finally{if(_)throw _.error}}else{Le=Fe.concat(),Fe=[];try{for(var Re=Lt(Le),ke=Re.next();!ke.done;ke=Re.next()){U=ke.value;try{for(var Ae=Lt(Se[de].items),Be=Ae.next();!Be.done;Be=Ae.next())(Ee=Be.value).dimensions=Se[de].dimensions,U instanceof Array?(Ne=Array.from(U),Fe.push(Ne.concat([Ee]))):Fe.push([U,Ee])}catch(bt){D={error:bt}}finally{try{Be&&!Be.done&&(I=Ae["return"])&&I.call(Ae)}finally{if(D)throw D.error}}}}catch(vt){L={error:vt}}finally{try{ke&&!ke.done&&(P=Re["return"])&&P.call(Re)}finally{if(L)throw L.error}}}var Ve=0;if(0!==Fe.length)try{for(var qe=Lt(Fe),Ge=qe.next();!Ge.done;Ge=qe.next()){U={items:[],headers:ge=Ge.value};try{for(var Je=Lt(ge),Ke=Je.next();!Ke.done;Ke=Je.next())Ee=Ke.value,0!==Ve&&Ve%Ee.dimensions.col_span!=0||U.items.push({type:Ee.type,name:Ee.uid,val:Ee.name,row_span:Ee.dimensions.col_span,header:!0})}catch(gt){N={error:gt}}finally{try{Ke&&!Ke.done&&(M=Je["return"])&&M.call(Je)}finally{if(N)throw N.error}}try{for(var Qe=Lt(je),Ue=Qe.next();!Ue.done;Ue=Qe.next()){var We=Ue.value,Xe=[];try{for(var Ye=Lt(ge),Ze=Ye.next();!Ze.done;Ze=Ye.next())Ee=Ze.value,Xe.push({type:Ee.type,value:Ee.uid})}catch(wt){H={error:wt}}finally{try{Ze&&!Ze.done&&(z=Ye["return"])&&z.call(Ye)}finally{if(H)throw H.error}}try{for(var $e=Lt(We),et=$e.next();!et.done;et=$e.next())Ee=et.value,Xe.push({type:Ee.type,value:Ee.uid})}catch(xt){R={error:xt}}finally{try{et&&!et.done&&(k=$e["return"])&&k.call($e)}finally{if(R)throw R.error}}U.items.push({name:"",val:Ct(e,Xe),color:Et(G,Ct(e,Xe)),row_span:"1",display:!0})}}catch(Ot){S={error:Ot}}finally{try{Ue&&!Ue.done&&(F=Qe["return"])&&F.call(Qe)}finally{if(S)throw S.error}}t.hasOwnProperty("hideEmptyRows")&&t.hideEmptyRows&&Nt(t.rows.length,U.items)||J.rows.push(U),Ve++}}catch(jt){C={error:jt}}finally{try{Ge&&!Ge.done&&(E=qe["return"])&&E.call(qe)}finally{if(C)throw C.error}}else{U={items:[],headers:[]};try{for(var tt=Lt(je),rt=tt.next();!rt.done;rt=tt.next()){We=rt.value,Xe=[];try{for(var nt=Lt(We),at=nt.next();!at.done;at=nt.next())Ee=at.value,Xe.push({type:Ee.type,value:Ee.uid})}catch(_t){V={error:_t}}finally{try{at&&!at.done&&(q=nt["return"])&&q.call(nt)}finally{if(V)throw V.error}}U.items.push({name:"",val:Ct(e,Xe),row_span:"1",display:!0})}}catch(Tt){A={error:Tt}}finally{try{rt&&!rt.done&&(B=tt["return"])&&B.call(tt)}finally{if(A)throw A.error}}t.hasOwnProperty("hideEmptyRows")&&t.hideEmptyRows&&Nt(t.rows.length,U.items)||J.rows.push(U)}}return J}(this.analyticsObject,this.tableConfiguration))},e.prototype.sortData=function(e,t,r){if(1===e.columns.length&&r){this.current_sorting=[],this.current_sorting[t]=!0;var n=void 0,a=void 0,l=void 0,o=void 0,i=void 0,s=void 0,c=void 0,u=void 0,h=0;for(n=document.getElementById("myPivotTable"),l=!0,u="asc";l;){for(l=!1,a=n.getElementsByTagName("TR"),o=0;o<a.length-1;o++)if(c=!1,i=a[o].getElementsByTagName("TD")[t],s=a[o+1].getElementsByTagName("TD")[t],"asc"===u){if(parseFloat(i.innerHTML)){if(parseFloat(i.innerHTML)>parseFloat(s.innerHTML)){c=!0;break}}else if(i.innerHTML.toLowerCase()>s.innerHTML.toLowerCase()){c=!0;break}this.sort_direction[t]="asc"}else if("desc"===u){if(parseFloat(i.innerHTML)){if(parseFloat(i.innerHTML)<parseFloat(s.innerHTML)){c=!0;break}}else if(i.innerHTML.toLowerCase()<s.innerHTML.toLowerCase()){c=!0;break}this.sort_direction[t]="desc"}c?(a[o].parentNode.insertBefore(a[o+1],a[o]),l=!0,h++):0===h&&"asc"===u&&(u="desc",this.sort_direction[t]="desc",l=!0)}}},e.decorators=[{type:t.Component,args:[{selector:"ngx-dhis2-table-item",template:'<div class="row">\n    <div class="col-md-12" *ngIf="tableObject">\n        <h5 style="margin-top: 80px" class="text-center" *ngIf="tableObject.rows.length == 0"> No data to display</h5>\n\n        <div *ngIf="tableObject" style="padding: 3px">\n            \x3c!--<h4 *ngIf="tableObject.rows.length != 0" class="text-center" style="margin-bottom: 0px">{{tableObject?.title}}</h4>--\x3e\n            <table class="table table-bordered table-responsive table-condensed custom-table" *ngIf="tableObject.rows.length != 0">\n                <thead>\n                    \x3c!--title--\x3e\n                    <tr class="table-title">\n                        <th [attr.colspan]="tableObject.rows[0].items.length">\n                            <h4 style="margin: 0px" class="text-center">{{tableObject.subtitle}} </h4>\n                        </th>\n                    </tr>\n                    \x3c!--headers--\x3e\n                    <tr *ngFor="let header of tableObject.headers; let j = index" class="header-column">\n                        <th *ngIf="tableObject.hasParentOu"></th>\n                        <th *ngFor="let table_column of tableObject.columns; let i = index" style="text-align: center">\n                            <span *ngIf="i==tableObject.columns.length-1 && j==tableObject.headers.length-1 && tableObject.titlesAvailable">{{ tableObject.titles.rows[i] }} / {{ tableObject.titles.column[j]}}</span>\n                            <span *ngIf="i != tableObject.columns.length-1">{{ tableObject.titles.rows[i] }}</span>\n                            <span *ngIf="j != tableObject.headers.length-1">{{ tableObject.titles.column[j] }}</span>\n                        </th>\n                        <th *ngFor="let header_column of header.items; let i=index" [colSpan]="header_column.span" style="text-align: center" (click)="sortData(tableObject,i+tableObject.columns.length,j+1==tableObject.headers.length)">\n                            {{ header_column.name }}\n                            <span *ngIf="j+1==tableObject.headers.length && current_sorting[i+tableObject.columns.length] && sort_direction[i+tableObject.columns.length] == \'asc\'" class="glyphicon glyphicon-triangle-top pull-right"></span>\n                            <span *ngIf="j+1==tableObject.headers.length && current_sorting[i+tableObject.columns.length] && sort_direction[i+tableObject.columns.length] == \'desc\'" class="glyphicon glyphicon-triangle-bottom pull-right"></span>\n                        </th>\n                    </tr>\n                </thead>\n                <tbody id="myPivotTable">\n                    <tr *ngFor="let row of tableObject.rows" [ngClass]="{\'sub-total\': row.sub_total}">\n                        <td *ngFor="let header_column of row.items;let i = index" [ngClass]="{\'header-column\': header_column.name != \'\'}" style="text-align: center;vertical-align: middle" [attr.rowspan]="header_column.row_span" [style.background]="header_column.color">\n                            {{ header_column.val }}\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n\n\n        </div>\n    </div>\n</div>',styles:[".table-item-container{overflow:hidden}.custom-table{display:table;border-style:none!important;width:100%}.custom-table td,.custom-table th{border:thin solid #f1f1f1}.custom-table>tbody>tr>td,.custom-table>thead>tr>th{font-size:13px!important}table tr th{background-color:rgba(238,238,238,.29);padding:4px;text-align:center}table tr td{padding:4px}table tr td:first-child{background-color:rgba(238,238,238,.29)}.table-title{font-size:13px;font-weight:600;text-align:center}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={tableConfiguration:[{type:t.Input}],analyticsObject:[{type:t.Input}]},e}(),l=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule],declarations:[n,a],exports:[n,a]}]}],e}();e.NgxDhis2TableModule=l,e.ɵb=a,e.ɵa=n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=hisptz-ngx-dhis2-table.umd.min.js.map