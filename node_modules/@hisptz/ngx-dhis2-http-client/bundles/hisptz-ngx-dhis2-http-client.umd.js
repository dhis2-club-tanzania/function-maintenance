(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@angular/common/http'), require('rxjs'), require('rxjs/internal/operators')) :
    typeof define === 'function' && define.amd ? define('@hisptz/ngx-dhis2-http-client', ['exports', '@angular/core', '@angular/common/http', 'rxjs', 'rxjs/internal/operators'], factory) :
    (factory((global.hisptz = global.hisptz || {}, global.hisptz['ngx-dhis2-http-client'] = {}),global.ng.core,global.ng.common.http,global.rxjs,global.rxjs['internal/operators']));
}(this, (function (exports,i0,i1,rxjs,operators) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var ManifestService = (function () {
        function ManifestService(httpClient) {
            this.httpClient = httpClient;
            this._defaultRootUrl = '../../../';
            this._manifestLoaded = false;
        }
        /**
         * @return {?}
         */
        ManifestService.prototype.getManifest = /**
         * @return {?}
         */
            function () {
                var _this = this;
                return this._manifestLoaded ? rxjs.of(this._manifest) : this.httpClient.get('manifest.webapp').pipe(operators.catchError(function () {
                    console.warn('Manifest file could not be loaded, default options have been used instead');
                    return rxjs.of(null);
                }), operators.tap(function (manifest) {
                    _this._manifest = manifest;
                    _this._manifestLoaded = true;
                }));
            };
        /**
         * @return {?}
         */
        ManifestService.prototype.getRootUrl = /**
         * @return {?}
         */
            function () {
                var _this = this;
                return this.getManifest().pipe(operators.map(function (manifest) {
                    if (!manifest) {
                        return _this._defaultRootUrl;
                    }
                    return manifest.activities && manifest.activities.dhis && manifest.activities.dhis.href ?
                        manifest.activities.dhis.href : _this._defaultRootUrl;
                }));
            };
        ManifestService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] },
        ];
        /** @nocollapse */
        ManifestService.ctorParameters = function () {
            return [
                { type: i1.HttpClient }
            ];
        };
        /** @nocollapse */ ManifestService.ngInjectableDef = i0.defineInjectable({ factory: function ManifestService_Factory() { return new ManifestService(i0.inject(i1.HttpClient)); }, token: ManifestService, providedIn: "root" });
        return ManifestService;
    }());

    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
    var __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s)
                if (Object.prototype.hasOwnProperty.call(s, p))
                    t[p] = s[p];
        }
        return t;
    };

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var SystemInfoService = (function () {
        function SystemInfoService(manifestService, httpClient) {
            this.manifestService = manifestService;
            this.httpClient = httpClient;
            this._systemInfoLoaded = false;
        }
        /**
         * @return {?}
         */
        SystemInfoService.prototype.getSystemInfo = /**
         * @return {?}
         */
            function () {
                var _this = this;
                return this._systemInfoLoaded ? rxjs.of(this._systemInfo) :
                    this.manifestService.getRootUrl().pipe(operators.switchMap(function (rootUrl) {
                        return rxjs.forkJoin(_this.httpClient.get(rootUrl + "api/system/info"), _this.httpClient.get(rootUrl + "api/systemSettings")).pipe(operators.map(function (res) {
                            return __assign({}, res[0], res[1]);
                        }), operators.tap(function (systemInfo) {
                            _this._systemInfo = systemInfo;
                            _this._systemInfoLoaded = true;
                        }));
                    }));
            };
        /**
         * @return {?}
         */
        SystemInfoService.prototype.getSystemVersion = /**
         * @return {?}
         */
            function () {
                return this.getSystemInfo().pipe(operators.map(function (systemInfo) {
                    if (!systemInfo) {
                        return 0;
                    }
                    var /** @type {?} */ splitedVersion = systemInfo.version ? systemInfo.version.split('.') : [];
                    return parseInt(splitedVersion[1], 10) || 0;
                }));
            };
        SystemInfoService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] },
        ];
        /** @nocollapse */
        SystemInfoService.ctorParameters = function () {
            return [
                { type: ManifestService },
                { type: i1.HttpClient }
            ];
        };
        /** @nocollapse */ SystemInfoService.ngInjectableDef = i0.defineInjectable({ factory: function SystemInfoService_Factory() { return new SystemInfoService(i0.inject(ManifestService), i0.inject(i1.HttpClient)); }, token: SystemInfoService, providedIn: "root" });
        return SystemInfoService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var NgxDhis2HttpClientService = (function () {
        function NgxDhis2HttpClientService(httpClient, manifestService, systemInfoService) {
            this.httpClient = httpClient;
            this.manifestService = manifestService;
            this.systemInfoService = systemInfoService;
        }
        /**
         * @param {?} url
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.get = /**
         * @param {?} url
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @return {?}
         */
            function (url, includeVersionNumber, preferPreviousApiVersion, useRootUrl) {
                var _this = this;
                if (includeVersionNumber === void 0) {
                    includeVersionNumber = false;
                }
                if (preferPreviousApiVersion === void 0) {
                    preferPreviousApiVersion = false;
                }
                if (useRootUrl === void 0) {
                    useRootUrl = false;
                }
                var /** @type {?} */ rootUrlPromise = useRootUrl
                    ? this.manifestService.getRootUrl()
                    : this._getApiRootUrl(includeVersionNumber, preferPreviousApiVersion);
                return rootUrlPromise.pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient.get(rootUrl + url).pipe(operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} url
         * @param {?} data
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @param {?=} headerOptions
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.post = /**
         * @param {?} url
         * @param {?} data
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @param {?=} headerOptions
         * @return {?}
         */
            function (url, data, includeVersionNumber, preferPreviousApiVersion, useRootUrl, headerOptions) {
                var _this = this;
                if (includeVersionNumber === void 0) {
                    includeVersionNumber = false;
                }
                if (preferPreviousApiVersion === void 0) {
                    preferPreviousApiVersion = false;
                }
                if (useRootUrl === void 0) {
                    useRootUrl = false;
                }
                var /** @type {?} */ rootUrlPromise = useRootUrl
                    ? this.manifestService.getRootUrl()
                    : this._getApiRootUrl(includeVersionNumber, preferPreviousApiVersion);
                return rootUrlPromise.pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient
                        .post(rootUrl + url, data)
                        .pipe(operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} url
         * @param {?} data
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.put = /**
         * @param {?} url
         * @param {?} data
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @return {?}
         */
            function (url, data, includeVersionNumber, preferPreviousApiVersion, useRootUrl) {
                var _this = this;
                if (includeVersionNumber === void 0) {
                    includeVersionNumber = false;
                }
                if (preferPreviousApiVersion === void 0) {
                    preferPreviousApiVersion = false;
                }
                if (useRootUrl === void 0) {
                    useRootUrl = false;
                }
                var /** @type {?} */ rootUrlPromise = useRootUrl
                    ? this.manifestService.getRootUrl()
                    : this._getApiRootUrl(includeVersionNumber, preferPreviousApiVersion);
                return rootUrlPromise.pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient
                        .put(rootUrl + url, data)
                        .pipe(operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} url
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype.delete = /**
         * @param {?} url
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousApiVersion
         * @param {?=} useRootUrl
         * @return {?}
         */
            function (url, includeVersionNumber, preferPreviousApiVersion, useRootUrl) {
                var _this = this;
                if (includeVersionNumber === void 0) {
                    includeVersionNumber = false;
                }
                if (preferPreviousApiVersion === void 0) {
                    preferPreviousApiVersion = false;
                }
                if (useRootUrl === void 0) {
                    useRootUrl = false;
                }
                var /** @type {?} */ rootUrlPromise = useRootUrl
                    ? this.manifestService.getRootUrl()
                    : this._getApiRootUrl(includeVersionNumber, preferPreviousApiVersion);
                return rootUrlPromise.pipe(operators.mergeMap(function (rootUrl) {
                    return _this.httpClient
                        .delete(rootUrl + url)
                        .pipe(operators.catchError(_this._handleError));
                }), operators.catchError(this._handleError));
            };
        /**
         * @param {?} err
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._handleError = /**
         * @param {?} err
         * @return {?}
         */
            function (err) {
                var /** @type {?} */ error = null;
                if (err.error instanceof ErrorEvent) {
                    // A client-side or network error occurred. Handle it accordingly.
                    error = {
                        message: err.error,
                        status: err.status,
                        statusText: err.statusText
                    };
                }
                else {
                    // The backend returned an unsuccessful response code.
                    // The response body may contain clues as to what went wrong,
                    error = {
                        message: err.error instanceof Object
                            ? err.error.message
                            : err.error || err.message,
                        status: err.status,
                        statusText: err.statusText
                    };
                }
                return rxjs.throwError(error);
            };
        /**
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousVersion
         * @return {?}
         */
        NgxDhis2HttpClientService.prototype._getApiRootUrl = /**
         * @param {?=} includeVersionNumber
         * @param {?=} preferPreviousVersion
         * @return {?}
         */
            function (includeVersionNumber, preferPreviousVersion) {
                var _this = this;
                if (includeVersionNumber === void 0) {
                    includeVersionNumber = false;
                }
                if (preferPreviousVersion === void 0) {
                    preferPreviousVersion = false;
                }
                var /** @type {?} */ rootUrlPromise = this.manifestService.getRootUrl().pipe(operators.switchMap(function (rootUrl) {
                    return _this.systemInfoService.getSystemVersion().pipe(operators.map(function (version) {
                        return {
                            rootUrl: rootUrl,
                            version: version - 1 <= 25 ? version + 1 : version
                        };
                    }));
                }));
                return rootUrlPromise.pipe(operators.map(function (urlInfo) {
                    return urlInfo.rootUrl + "api/" + (includeVersionNumber && !preferPreviousVersion
                        ? urlInfo.version + '/'
                        : preferPreviousVersion
                            ? urlInfo.version
                                ? urlInfo.version - 1 + '/'
                                : ''
                            : '');
                }));
            };
        NgxDhis2HttpClientService.decorators = [
            { type: i0.Injectable, args: [{ providedIn: 'root' },] },
        ];
        /** @nocollapse */
        NgxDhis2HttpClientService.ctorParameters = function () {
            return [
                { type: i1.HttpClient },
                { type: ManifestService },
                { type: SystemInfoService }
            ];
        };
        /** @nocollapse */ NgxDhis2HttpClientService.ngInjectableDef = i0.defineInjectable({ factory: function NgxDhis2HttpClientService_Factory() { return new NgxDhis2HttpClientService(i0.inject(i1.HttpClient), i0.inject(ManifestService), i0.inject(SystemInfoService)); }, token: NgxDhis2HttpClientService, providedIn: "root" });
        return NgxDhis2HttpClientService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var /** @type {?} */ services = [ManifestService, SystemInfoService, NgxDhis2HttpClientService];

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    exports.services = services;
    exports.ManifestService = ManifestService;
    exports.SystemInfoService = SystemInfoService;
    exports.NgxDhis2HttpClientService = NgxDhis2HttpClientService;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlzcHR6LW5neC1kaGlzMi1odHRwLWNsaWVudC51bWQuanMubWFwIiwic291cmNlcyI6WyJuZzovL0BoaXNwdHovbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9zZXJ2aWNlcy9tYW5pZmVzdC5zZXJ2aWNlLnRzIixudWxsLCJuZzovL0BoaXNwdHovbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9zZXJ2aWNlcy9zeXN0ZW0taW5mby5zZXJ2aWNlLnRzIiwibmc6Ly9AaGlzcHR6L25neC1kaGlzMi1odHRwLWNsaWVudC9saWIvc2VydmljZXMvbmd4LWRoaXMyLWh0dHAtY2xpZW50LnNlcnZpY2UudHMiLCJuZzovL0BoaXNwdHovbmd4LWRoaXMyLWh0dHAtY2xpZW50L2xpYi9zZXJ2aWNlcy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgTWFuaWZlc3QgfSBmcm9tICcuLi9tb2RlbHMnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRhcCwgY2F0Y2hFcnJvciwgbWFwIH0gZnJvbSAncnhqcy9pbnRlcm5hbC9vcGVyYXRvcnMnO1xuXG5ASW5qZWN0YWJsZSh7cHJvdmlkZWRJbjogJ3Jvb3QnfSlcbmV4cG9ydCBjbGFzcyBNYW5pZmVzdFNlcnZpY2Uge1xuICBwcml2YXRlIF9tYW5pZmVzdDogTWFuaWZlc3Q7XG4gIHByaXZhdGUgX2RlZmF1bHRSb290VXJsOiBzdHJpbmc7XG4gIHByaXZhdGUgX21hbmlmZXN0TG9hZGVkOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCkge1xuICAgIHRoaXMuX2RlZmF1bHRSb290VXJsID0gJy4uLy4uLy4uLyc7XG4gICAgdGhpcy5fbWFuaWZlc3RMb2FkZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRNYW5pZmVzdCgpOiBPYnNlcnZhYmxlPE1hbmlmZXN0PiB7XG4gICAgcmV0dXJuIHRoaXMuX21hbmlmZXN0TG9hZGVkID8gb2YodGhpcy5fbWFuaWZlc3QpIDogdGhpcy5odHRwQ2xpZW50LmdldDxNYW5pZmVzdD4oJ21hbmlmZXN0LndlYmFwcCcpLnBpcGUoXG4gICAgICBjYXRjaEVycm9yKCgpID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKCdNYW5pZmVzdCBmaWxlIGNvdWxkIG5vdCBiZSBsb2FkZWQsIGRlZmF1bHQgb3B0aW9ucyBoYXZlIGJlZW4gdXNlZCBpbnN0ZWFkJyk7XG4gICAgICAgIHJldHVybiBvZihudWxsKTtcbiAgICAgIH0pLFxuICAgICAgdGFwKChtYW5pZmVzdCkgPT4ge1xuICAgICAgICB0aGlzLl9tYW5pZmVzdCA9IG1hbmlmZXN0O1xuICAgICAgICB0aGlzLl9tYW5pZmVzdExvYWRlZCA9IHRydWU7XG4gICAgICB9KSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0Um9vdFVybCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmdldE1hbmlmZXN0KCkucGlwZShtYXAoKG1hbmlmZXN0OiBNYW5pZmVzdCkgPT4ge1xuICAgICAgaWYgKCFtYW5pZmVzdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdFJvb3RVcmw7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWFuaWZlc3QuYWN0aXZpdGllcyAmJiBtYW5pZmVzdC5hY3Rpdml0aWVzLmRoaXMgJiYgbWFuaWZlc3QuYWN0aXZpdGllcy5kaGlzLmhyZWYgP1xuICAgICAgICBtYW5pZmVzdC5hY3Rpdml0aWVzLmRoaXMuaHJlZiA6IHRoaXMuX2RlZmF1bHRSb290VXJsO1xuICAgIH0pKTtcbiAgfVxufVxuIiwiLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcclxudGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcclxuTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcclxuS0lORCwgRUlUSEVSIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIFdJVEhPVVQgTElNSVRBVElPTiBBTlkgSU1QTElFRFxyXG5XQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgVElUTEUsIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLFxyXG5NRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULlxyXG5cclxuU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXHJcbmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVzdChzLCBlKSB7XHJcbiAgICB2YXIgdCA9IHt9O1xyXG4gICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXHJcbiAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDApXHJcbiAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChfKSB0cnkge1xyXG4gICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5W1wicmV0dXJuXCJdIDogb3BbMF0gPyB5W1widGhyb3dcIl0gfHwgKCh0ID0geVtcInJldHVyblwiXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7XHJcbiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTtcclxuICAgICAgICAgICAgc3dpdGNoIChvcFswXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9O1xyXG4gICAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9XHJcbiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4cG9ydFN0YXIobSwgZXhwb3J0cykge1xyXG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAoIWV4cG9ydHMuaGFzT3duUHJvcGVydHkocCkpIGV4cG9ydHNbcF0gPSBtW3BdO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX192YWx1ZXMobykge1xyXG4gICAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdLCBpID0gMDtcclxuICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkKCkge1xyXG4gICAgZm9yICh2YXIgYXIgPSBbXSwgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgYXIgPSBhci5jb25jYXQoX19yZWFkKGFyZ3VtZW50c1tpXSkpO1xyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdCh2KSB7XHJcbiAgICByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIF9fYXdhaXQgPyAodGhpcy52ID0gdiwgdGhpcykgOiBuZXcgX19hd2FpdCh2KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNHZW5lcmF0b3IodGhpc0FyZywgX2FyZ3VtZW50cywgZ2VuZXJhdG9yKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIGcgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSksIGksIHEgPSBbXTtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpZiAoZ1tuXSkgaVtuXSA9IGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoYSwgYikgeyBxLnB1c2goW24sIHYsIGEsIGJdKSA+IDEgfHwgcmVzdW1lKG4sIHYpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gcmVzdW1lKG4sIHYpIHsgdHJ5IHsgc3RlcChnW25dKHYpKTsgfSBjYXRjaCAoZSkgeyBzZXR0bGUocVswXVszXSwgZSk7IH0gfVxyXG4gICAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9XHJcbiAgICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7IHJlc3VtZShcIm5leHRcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKFwidGhyb3dcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiBzZXR0bGUoZiwgdikgeyBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jRGVsZWdhdG9yKG8pIHtcclxuICAgIHZhciBpLCBwO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiLCBmdW5jdGlvbiAoZSkgeyB0aHJvdyBlOyB9KSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobiwgZikgeyBpW25dID0gb1tuXSA/IGZ1bmN0aW9uICh2KSB7IHJldHVybiAocCA9ICFwKSA/IHsgdmFsdWU6IF9fYXdhaXQob1tuXSh2KSksIGRvbmU6IG4gPT09IFwicmV0dXJuXCIgfSA6IGYgPyBmKHYpIDogdjsgfSA6IGY7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNWYWx1ZXMobykge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBtID0gb1tTeW1ib2wuYXN5bmNJdGVyYXRvcl0sIGk7XHJcbiAgICByZXR1cm4gbSA/IG0uY2FsbChvKSA6IChvID0gdHlwZW9mIF9fdmFsdWVzID09PSBcImZ1bmN0aW9uXCIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaVtuXSA9IG9bbl0gJiYgZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdiA9IG9bbl0odiksIHNldHRsZShyZXNvbHZlLCByZWplY3QsIHYuZG9uZSwgdi52YWx1ZSk7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCBkLCB2KSB7IFByb21pc2UucmVzb2x2ZSh2KS50aGVuKGZ1bmN0aW9uKHYpIHsgcmVzb2x2ZSh7IHZhbHVlOiB2LCBkb25lOiBkIH0pOyB9LCByZWplY3QpOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ha2VUZW1wbGF0ZU9iamVjdChjb29rZWQsIHJhdykge1xyXG4gICAgaWYgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoY29va2VkLCBcInJhd1wiLCB7IHZhbHVlOiByYXcgfSk7IH0gZWxzZSB7IGNvb2tlZC5yYXcgPSByYXc7IH1cclxuICAgIHJldHVybiBjb29rZWQ7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xyXG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcclxuICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSByZXN1bHRba10gPSBtb2Rba107XHJcbiAgICByZXN1bHQuZGVmYXVsdCA9IG1vZDtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcbiIsImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGZvcmtKb2luLCBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTWFuaWZlc3RTZXJ2aWNlIH0gZnJvbSAnLi9tYW5pZmVzdC5zZXJ2aWNlJztcbmltcG9ydCB7IG1hcCwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL2ludGVybmFsL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5ASW5qZWN0YWJsZSh7cHJvdmlkZWRJbjogJ3Jvb3QnfSlcbmV4cG9ydCBjbGFzcyBTeXN0ZW1JbmZvU2VydmljZSB7XG4gIHByaXZhdGUgX3N5c3RlbUluZm9Mb2FkZWQ6IGJvb2xlYW47XG4gIHByaXZhdGUgX3N5c3RlbUluZm86IGFueTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1hbmlmZXN0U2VydmljZTogTWFuaWZlc3RTZXJ2aWNlLCBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHtcbiAgICB0aGlzLl9zeXN0ZW1JbmZvTG9hZGVkID0gZmFsc2U7XG4gIH1cblxuICBnZXRTeXN0ZW1JbmZvKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N5c3RlbUluZm9Mb2FkZWQgPyBvZih0aGlzLl9zeXN0ZW1JbmZvKSA6XG4gICAgICB0aGlzLm1hbmlmZXN0U2VydmljZS5nZXRSb290VXJsKCkucGlwZShcbiAgICAgICAgc3dpdGNoTWFwKChyb290VXJsOiBzdHJpbmcpID0+IGZvcmtKb2luKHRoaXMuaHR0cENsaWVudC5nZXQoYCR7cm9vdFVybH1hcGkvc3lzdGVtL2luZm9gKSxcbiAgICAgICAgICB0aGlzLmh0dHBDbGllbnQuZ2V0KGAke3Jvb3RVcmx9YXBpL3N5c3RlbVNldHRpbmdzYCkpLnBpcGUobWFwKChyZXM6IGFueVtdKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHsuLi5yZXNbMF0sIC4uLnJlc1sxXX07XG4gICAgICAgIH0pLCB0YXAoKHN5c3RlbUluZm86IGFueSkgPT4ge1xuICAgICAgICAgIHRoaXMuX3N5c3RlbUluZm8gPSBzeXN0ZW1JbmZvO1xuICAgICAgICAgIHRoaXMuX3N5c3RlbUluZm9Mb2FkZWQgPSB0cnVlO1xuICAgICAgICB9KSkpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRTeXN0ZW1WZXJzaW9uKCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3lzdGVtSW5mbygpLnBpcGUobWFwKChzeXN0ZW1JbmZvOiBhbnkpID0+IHtcbiAgICAgIGlmICghc3lzdGVtSW5mbykge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNwbGl0ZWRWZXJzaW9uID0gc3lzdGVtSW5mby52ZXJzaW9uID8gc3lzdGVtSW5mby52ZXJzaW9uLnNwbGl0KCcuJykgOiBbXTtcbiAgICAgIHJldHVybiBwYXJzZUludChzcGxpdGVkVmVyc2lvblsxXSwgMTApIHx8IDA7XG4gICAgfSkpO1xuICB9XG59XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IE1hbmlmZXN0U2VydmljZSB9IGZyb20gJy4vbWFuaWZlc3Quc2VydmljZSc7XG5pbXBvcnQgeyBTeXN0ZW1JbmZvU2VydmljZSB9IGZyb20gJy4vc3lzdGVtLWluZm8uc2VydmljZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCB0aHJvd0Vycm9yIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBtYXAsIG1lcmdlTWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL2ludGVybmFsL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXG5leHBvcnQgY2xhc3MgTmd4RGhpczJIdHRwQ2xpZW50U2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCxcbiAgICBwcml2YXRlIG1hbmlmZXN0U2VydmljZTogTWFuaWZlc3RTZXJ2aWNlLFxuICAgIHByaXZhdGUgc3lzdGVtSW5mb1NlcnZpY2U6IFN5c3RlbUluZm9TZXJ2aWNlXG4gICkge31cblxuICBnZXQoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgaW5jbHVkZVZlcnNpb25OdW1iZXI6IGJvb2xlYW4gPSBmYWxzZSxcbiAgICBwcmVmZXJQcmV2aW91c0FwaVZlcnNpb246IGJvb2xlYW4gPSBmYWxzZSxcbiAgICB1c2VSb290VXJsOiBib29sZWFuID0gZmFsc2VcbiAgKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCByb290VXJsUHJvbWlzZSA9IHVzZVJvb3RVcmxcbiAgICAgID8gdGhpcy5tYW5pZmVzdFNlcnZpY2UuZ2V0Um9vdFVybCgpXG4gICAgICA6IHRoaXMuX2dldEFwaVJvb3RVcmwoaW5jbHVkZVZlcnNpb25OdW1iZXIsIHByZWZlclByZXZpb3VzQXBpVmVyc2lvbik7XG5cbiAgICByZXR1cm4gcm9vdFVybFByb21pc2UucGlwZShcbiAgICAgIG1lcmdlTWFwKHJvb3RVcmwgPT5cbiAgICAgICAgdGhpcy5odHRwQ2xpZW50LmdldChyb290VXJsICsgdXJsKS5waXBlKGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpKVxuICAgICAgKSxcbiAgICAgIGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpXG4gICAgKTtcbiAgfVxuXG4gIHBvc3QoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgZGF0YTogYW55LFxuICAgIGluY2x1ZGVWZXJzaW9uTnVtYmVyOiBib29sZWFuID0gZmFsc2UsXG4gICAgcHJlZmVyUHJldmlvdXNBcGlWZXJzaW9uOiBib29sZWFuID0gZmFsc2UsXG4gICAgdXNlUm9vdFVybDogYm9vbGVhbiA9IGZhbHNlLFxuICAgIGhlYWRlck9wdGlvbnM/OiBhbnlcbiAgKSB7XG4gICAgY29uc3Qgcm9vdFVybFByb21pc2UgPSB1c2VSb290VXJsXG4gICAgICA/IHRoaXMubWFuaWZlc3RTZXJ2aWNlLmdldFJvb3RVcmwoKVxuICAgICAgOiB0aGlzLl9nZXRBcGlSb290VXJsKGluY2x1ZGVWZXJzaW9uTnVtYmVyLCBwcmVmZXJQcmV2aW91c0FwaVZlcnNpb24pO1xuICAgIHJldHVybiByb290VXJsUHJvbWlzZS5waXBlKFxuICAgICAgbWVyZ2VNYXAocm9vdFVybCA9PlxuICAgICAgICB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgICAucG9zdChyb290VXJsICsgdXJsLCBkYXRhKVxuICAgICAgICAgIC5waXBlKGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpKVxuICAgICAgKSxcbiAgICAgIGNhdGNoRXJyb3IodGhpcy5faGFuZGxlRXJyb3IpXG4gICAgKTtcbiAgfVxuXG4gIHB1dChcbiAgICB1cmw6IHN0cmluZyxcbiAgICBkYXRhOiBhbnksXG4gICAgaW5jbHVkZVZlcnNpb25OdW1iZXI6IGJvb2xlYW4gPSBmYWxzZSxcbiAgICBwcmVmZXJQcmV2aW91c0FwaVZlcnNpb246IGJvb2xlYW4gPSBmYWxzZSxcbiAgICB1c2VSb290VXJsOiBib29sZWFuID0gZmFsc2VcbiAgKSB7XG4gICAgY29uc3Qgcm9vdFVybFByb21pc2UgPSB1c2VSb290VXJsXG4gICAgICA/IHRoaXMubWFuaWZlc3RTZXJ2aWNlLmdldFJvb3RVcmwoKVxuICAgICAgOiB0aGlzLl9nZXRBcGlSb290VXJsKGluY2x1ZGVWZXJzaW9uTnVtYmVyLCBwcmVmZXJQcmV2aW91c0FwaVZlcnNpb24pO1xuXG4gICAgcmV0dXJuIHJvb3RVcmxQcm9taXNlLnBpcGUoXG4gICAgICBtZXJnZU1hcChyb290VXJsID0+XG4gICAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgIC5wdXQocm9vdFVybCArIHVybCwgZGF0YSlcbiAgICAgICAgICAucGlwZShjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKSlcbiAgICAgICksXG4gICAgICBjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKVxuICAgICk7XG4gIH1cblxuICBkZWxldGUoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgaW5jbHVkZVZlcnNpb25OdW1iZXI6IGJvb2xlYW4gPSBmYWxzZSxcbiAgICBwcmVmZXJQcmV2aW91c0FwaVZlcnNpb246IGJvb2xlYW4gPSBmYWxzZSxcbiAgICB1c2VSb290VXJsOiBib29sZWFuID0gZmFsc2VcbiAgKSB7XG4gICAgY29uc3Qgcm9vdFVybFByb21pc2UgPSB1c2VSb290VXJsXG4gICAgICA/IHRoaXMubWFuaWZlc3RTZXJ2aWNlLmdldFJvb3RVcmwoKVxuICAgICAgOiB0aGlzLl9nZXRBcGlSb290VXJsKGluY2x1ZGVWZXJzaW9uTnVtYmVyLCBwcmVmZXJQcmV2aW91c0FwaVZlcnNpb24pO1xuXG4gICAgcmV0dXJuIHJvb3RVcmxQcm9taXNlLnBpcGUoXG4gICAgICBtZXJnZU1hcChyb290VXJsID0+XG4gICAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAgIC5kZWxldGUocm9vdFVybCArIHVybClcbiAgICAgICAgICAucGlwZShjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKSlcbiAgICAgICksXG4gICAgICBjYXRjaEVycm9yKHRoaXMuX2hhbmRsZUVycm9yKVxuICAgICk7XG4gIH1cblxuICAvLyBwcml2YXRlIG1ldGhvZHNcbiAgcHJpdmF0ZSBfaGFuZGxlRXJyb3IoZXJyOiBIdHRwRXJyb3JSZXNwb25zZSkge1xuICAgIGxldCBlcnJvciA9IG51bGw7XG4gICAgaWYgKGVyci5lcnJvciBpbnN0YW5jZW9mIEVycm9yRXZlbnQpIHtcbiAgICAgIC8vIEEgY2xpZW50LXNpZGUgb3IgbmV0d29yayBlcnJvciBvY2N1cnJlZC4gSGFuZGxlIGl0IGFjY29yZGluZ2x5LlxuICAgICAgZXJyb3IgPSB7XG4gICAgICAgIG1lc3NhZ2U6IGVyci5lcnJvcixcbiAgICAgICAgc3RhdHVzOiBlcnIuc3RhdHVzLFxuICAgICAgICBzdGF0dXNUZXh0OiBlcnIuc3RhdHVzVGV4dFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVGhlIGJhY2tlbmQgcmV0dXJuZWQgYW4gdW5zdWNjZXNzZnVsIHJlc3BvbnNlIGNvZGUuXG4gICAgICAvLyBUaGUgcmVzcG9uc2UgYm9keSBtYXkgY29udGFpbiBjbHVlcyBhcyB0byB3aGF0IHdlbnQgd3JvbmcsXG4gICAgICBlcnJvciA9IHtcbiAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICBlcnIuZXJyb3IgaW5zdGFuY2VvZiBPYmplY3RcbiAgICAgICAgICAgID8gZXJyLmVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIDogZXJyLmVycm9yIHx8IGVyci5tZXNzYWdlLFxuICAgICAgICBzdGF0dXM6IGVyci5zdGF0dXMsXG4gICAgICAgIHN0YXR1c1RleHQ6IGVyci5zdGF0dXNUZXh0XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gdGhyb3dFcnJvcihlcnJvcik7XG4gIH1cblxuICBwcml2YXRlIF9nZXRBcGlSb290VXJsKFxuICAgIGluY2x1ZGVWZXJzaW9uTnVtYmVyOiBib29sZWFuID0gZmFsc2UsXG4gICAgcHJlZmVyUHJldmlvdXNWZXJzaW9uOiBib29sZWFuID0gZmFsc2VcbiAgKSB7XG4gICAgY29uc3Qgcm9vdFVybFByb21pc2UgPSB0aGlzLm1hbmlmZXN0U2VydmljZS5nZXRSb290VXJsKCkucGlwZShcbiAgICAgIHN3aXRjaE1hcChyb290VXJsID0+XG4gICAgICAgIHRoaXMuc3lzdGVtSW5mb1NlcnZpY2UuZ2V0U3lzdGVtVmVyc2lvbigpLnBpcGUoXG4gICAgICAgICAgbWFwKCh2ZXJzaW9uOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHJvb3RVcmwsXG4gICAgICAgICAgICAgIHZlcnNpb246IHZlcnNpb24gLSAxIDw9IDI1ID8gdmVyc2lvbiArIDEgOiB2ZXJzaW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiByb290VXJsUHJvbWlzZS5waXBlKFxuICAgICAgbWFwKFxuICAgICAgICAodXJsSW5mbzogeyByb290VXJsOiBzdHJpbmc7IHZlcnNpb246IG51bWJlciB9KSA9PlxuICAgICAgICAgIGAke3VybEluZm8ucm9vdFVybH1hcGkvJHtcbiAgICAgICAgICAgIGluY2x1ZGVWZXJzaW9uTnVtYmVyICYmICFwcmVmZXJQcmV2aW91c1ZlcnNpb25cbiAgICAgICAgICAgICAgPyB1cmxJbmZvLnZlcnNpb24gKyAnLydcbiAgICAgICAgICAgICAgOiBwcmVmZXJQcmV2aW91c1ZlcnNpb25cbiAgICAgICAgICAgICAgICA/IHVybEluZm8udmVyc2lvblxuICAgICAgICAgICAgICAgICAgPyB1cmxJbmZvLnZlcnNpb24gLSAxICsgJy8nXG4gICAgICAgICAgICAgICAgICA6ICcnXG4gICAgICAgICAgICAgICAgOiAnJ1xuICAgICAgICAgIH1gXG4gICAgICApXG4gICAgKTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgTWFuaWZlc3RTZXJ2aWNlIH0gZnJvbSAnLi9tYW5pZmVzdC5zZXJ2aWNlJztcbmltcG9ydCB7IFN5c3RlbUluZm9TZXJ2aWNlIH0gZnJvbSAnLi9zeXN0ZW0taW5mby5zZXJ2aWNlJztcbmltcG9ydCB7IE5neERoaXMySHR0cENsaWVudFNlcnZpY2UgfSBmcm9tICcuL25neC1kaGlzMi1odHRwLWNsaWVudC5zZXJ2aWNlJztcblxuZXhwb3J0IGNvbnN0IHNlcnZpY2VzOiBhbnlbXSA9IFtNYW5pZmVzdFNlcnZpY2UsIFN5c3RlbUluZm9TZXJ2aWNlLCBOZ3hEaGlzMkh0dHBDbGllbnRTZXJ2aWNlXTtcblxuZXhwb3J0ICogZnJvbSAnLi9tYW5pZmVzdC5zZXJ2aWNlJztcbmV4cG9ydCAqIGZyb20gJy4vc3lzdGVtLWluZm8uc2VydmljZSc7XG5leHBvcnQgKiBmcm9tICcuL25neC1kaGlzMi1odHRwLWNsaWVudC5zZXJ2aWNlJztcbiJdLCJuYW1lcyI6WyJvZiIsImNhdGNoRXJyb3IiLCJ0YXAiLCJtYXAiLCJJbmplY3RhYmxlIiwiSHR0cENsaWVudCIsInN3aXRjaE1hcCIsImZvcmtKb2luIiwibWVyZ2VNYXAiLCJ0aHJvd0Vycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7UUFZRSx5QkFBb0IsVUFBc0I7WUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtZQUN4QyxJQUFJLENBQUMsZUFBZSxHQUFHLFdBQVcsQ0FBQztZQUNuQyxJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztTQUM5Qjs7OztRQUVNLHFDQUFXOzs7OztnQkFDaEIsT0FBTyxJQUFJLENBQUMsZUFBZSxHQUFHQSxPQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFXLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUN0R0Msb0JBQVUsQ0FBQztvQkFDVCxPQUFPLENBQUMsSUFBSSxDQUFDLDJFQUEyRSxDQUFDLENBQUM7b0JBQzFGLE9BQU9ELE9BQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDakIsQ0FBQyxFQUNGRSxhQUFHLENBQUMsVUFBQyxRQUFRO29CQUNYLEtBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO29CQUMxQixLQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztpQkFDN0Is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